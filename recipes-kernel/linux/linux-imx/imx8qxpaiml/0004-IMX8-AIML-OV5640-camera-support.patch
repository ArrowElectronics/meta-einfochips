From 3e0b6611ef31c868c534bdb834b4d5524264f34c Mon Sep 17 00:00:00 2001
From: "darshak.patel" <darshak.patel@einfochips.com>
Date: Tue, 20 Oct 2020 16:11:46 +0530
Subject: [PATCH] IMX8 AIML: OV5640 camera support

---
 .../dts/freescale/imx8qxp-aiml-ei-ov5640.dts  | 13 +++-
 .../dts/freescale/imx8x-aiml-ei-rpmsg.dtsi    | 26 --------
 .../boot/dts/freescale/imx8x-aiml-ei.dtsi     | 63 -------------------
 3 files changed, 11 insertions(+), 91 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/imx8qxp-aiml-ei-ov5640.dts b/arch/arm64/boot/dts/freescale/imx8qxp-aiml-ei-ov5640.dts
index 66fd004cafad..6e684916f65e 100644
--- a/arch/arm64/boot/dts/freescale/imx8qxp-aiml-ei-ov5640.dts
+++ b/arch/arm64/boot/dts/freescale/imx8qxp-aiml-ei-ov5640.dts
@@ -42,6 +42,15 @@
		};
	};
 };
+&iomuxc {
+	pinctrl_mipi_csi0: mipi_csi0 {
+		fsl,pins = <
+			IMX8QXP_ADC_IN4_LSIO_GPIO1_IO14                                         0xc600004c
+			IMX8QXP_MCLK_IN0_LSIO_GPIO0_IO19                                        0xc600004c
+			IMX8QXP_MIPI_CSI0_MCLK_OUT_MIPI_CSI0_ACM_MCLK_OUT   			0xC0000041
+		>;
+        };
+};

 &i2c_mipi_csi0 {
	ov5640_mipi: ov5640_mipi@3c {
@@ -52,8 +61,8 @@
		clocks = <&xtal24m>;
		clock-names = "xclk";
		csi_id = <0>;
-		powerdown-gpios = <&lsio_gpio3 7 GPIO_ACTIVE_HIGH>;
-		reset-gpios = <&lsio_gpio3 8 GPIO_ACTIVE_LOW>;
+		powerdown-gpios = <&lsio_gpio1 14 GPIO_ACTIVE_HIGH>;
+		reset-gpios = <&lsio_gpio0 19 GPIO_ACTIVE_LOW>;
		mclk = <24000000>;
		mclk_source = <0>;
		mipi_csi;
diff --git a/arch/arm64/boot/dts/freescale/imx8x-aiml-ei-rpmsg.dtsi b/arch/arm64/boot/dts/freescale/imx8x-aiml-ei-rpmsg.dtsi
index 904b9eb61770..e83c423c1286 100644
--- a/arch/arm64/boot/dts/freescale/imx8x-aiml-ei-rpmsg.dtsi
+++ b/arch/arm64/boot/dts/freescale/imx8x-aiml-ei-rpmsg.dtsi
@@ -18,32 +18,6 @@
	#size-cells = <0>;
	status = "okay";

-	ov5640: ov5640@3c {
-		compatible = "ovti,ov5640";
-		reg = <0x3c>;
-		pinctrl-names = "default";
-		pinctrl-0 = <&pinctrl_parallel_csi>;
-		clocks = <&pi0_misc_lpcg 0>;
-		assigned-clocks = <&pi0_misc_lpcg 0>;
-		assigned-clock-rates = <24000000>;
-		clock-names = "xclk";
-		powerdown-gpios = <&lsio_gpio3 2 GPIO_ACTIVE_HIGH>;
-		reset-gpios = <&lsio_gpio3 3 GPIO_ACTIVE_LOW>;
-		csi_id = <0>;
-		mclk = <24000000>;
-		mclk_source = <0>;
-		status = "okay";
-		port {
-			ov5640_ep: endpoint {
-				remote-endpoint = <&parallel_csi_ep>;
-				bus-type = <5>; /* V4L2_FWNODE_BUS_TYPE_PARALLEL */
-				bus-width = <8>;
-				vsync-active = <0>;
-				hsync-active = <1>;
-				pclk-sample = <1>;
-			};
-		};
-	};
 };

 &i2c_rpbus_12 {
diff --git a/arch/arm64/boot/dts/freescale/imx8x-aiml-ei.dtsi b/arch/arm64/boot/dts/freescale/imx8x-aiml-ei.dtsi
index 23551c7268ee..da97bc86c9fe 100644
--- a/arch/arm64/boot/dts/freescale/imx8x-aiml-ei.dtsi
+++ b/arch/arm64/boot/dts/freescale/imx8x-aiml-ei.dtsi
@@ -165,32 +165,6 @@
		status = "okay";
	};

-	ov5640: ov5640@3c {
-		compatible = "ovti,ov5640";
-		reg = <0x3c>;
-		pinctrl-names = "default";
-		pinctrl-0 = <&pinctrl_parallel_csi>;
-		clocks = <&pi0_misc_lpcg 0>;
-		assigned-clocks = <&pi0_misc_lpcg 0>;
-		assigned-clock-rates = <24000000>;
-		clock-names = "xclk";
-		powerdown-gpios = <&lsio_gpio3 2 GPIO_ACTIVE_HIGH>;
-		reset-gpios = <&lsio_gpio3 3 GPIO_ACTIVE_LOW>;
-		csi_id = <0>;
-		mclk = <24000000>;
-		mclk_source = <0>;
-		status = "okay";
-		port {
-			ov5640_ep: endpoint {
-				remote-endpoint = <&parallel_csi_ep>;
-				bus-type = <5>; /* V4L2_FWNODE_BUS_TYPE_PARALLEL */
-				bus-width = <8>;
-				vsync-active = <0>;
-				hsync-active = <1>;
-				pclk-sample = <1>;
-			};
-		};
-	};
 };

 &cm40_intmux {
@@ -738,23 +712,6 @@
	};
 };

-&cameradev {
-	parallel_csi;
-	status = "okay";
-};
-
-&parallel_csi {
-	#address-cells = <1>;
-	#size-cells = <0>;
-	status = "okay";
-	port@0 {
-		reg = <0>;
-		parallel_csi_ep: endpoint {
-			remote-endpoint = <&ov5640_ep>;
-		};
-	};
-};
-
 &jpegdec {
	status = "okay";
 };
@@ -1024,24 +981,4 @@
		>;
	};

-	pinctrl_parallel_csi: parallelcsigrp {
-		fsl,pins = <
-			IMX8QXP_CSI_D00_CI_PI_D02		0xC0000041
-			IMX8QXP_CSI_D01_CI_PI_D03		0xC0000041
-			IMX8QXP_CSI_D02_CI_PI_D04		0xC0000041
-			IMX8QXP_CSI_D03_CI_PI_D05		0xC0000041
-			IMX8QXP_CSI_D04_CI_PI_D06		0xC0000041
-			IMX8QXP_CSI_D05_CI_PI_D07		0xC0000041
-			IMX8QXP_CSI_D06_CI_PI_D08		0xC0000041
-			IMX8QXP_CSI_D07_CI_PI_D09		0xC0000041
-
-			IMX8QXP_CSI_MCLK_CI_PI_MCLK		0xC0000041
-			IMX8QXP_CSI_PCLK_CI_PI_PCLK		0xC0000041
-			IMX8QXP_CSI_HSYNC_CI_PI_HSYNC		0xC0000041
-			IMX8QXP_CSI_VSYNC_CI_PI_VSYNC		0xC0000041
-			IMX8QXP_CSI_EN_LSIO_GPIO3_IO02		0xC0000041
-			IMX8QXP_CSI_RESET_LSIO_GPIO3_IO03	0xC0000041
-		>;
-	};
-
 };
--
2.17.1
