(function(){var e,i,n,r,t,o,s,a;t=window.rh,i=t._,e=t.$,n=t.consts,r=t.model,i.getRootUrl=(o=null,function(){return null!=o?o:o=""+i.getHostFolder()+n("START_FILEPATH")}),i.runTopicLoadingAnimation=(s=null,a=!1,function(t){return(a=t)?(null==s&&(s=i.debounce(function(){return r.publish(n("EVT_TOPIC_LOADING"),a)},700)),s()):(s=null,r.publish(n("EVT_TOPIC_LOADING"),!1))}),i.getTopicFrame=function(){var t;return t=window.gTopicFrameName||"rh_default_topic_frame_name",e("[name="+t+"]",0)}}).call(this),function(){var s,a,r,o,e,u,l;l=window.rh,s=l._,l.$,a=l.consts,(o=l.model).publish(a("KEY_SHOW_TAGS"),"true"===l._params.showtags),o.publish(a("KEY_IFRAME_EVENTS"),{click:!0}),e={},r=function(){var t;return t=s.hashParams(),o.publish(a("EVT_HASH_CHANGE"),{oldMap:e,newMap:t},{sync:!0}),e=t},u=function(){var t,e,i,n,r,o;if(r=s.extractParamString(document.location.href),n=s.urlParams(r),e=s.extractHashString(document.location.href),t=s.hashParams(e),i=a("RHMAPNO"),o=a("HASH_KEY_TOPIC"),!(i in n||o in t))return document.location=a("DEFAULT_TOPIC")},s.addEventListener(window,"hashchange",r),s.addEventListener(window,"orientationchange",function(t){var e,i;if(o.publish(a("EVT_ORIENTATION_CHANGE"),null),o.get(a("KEY_SCREEN_IPAD"))&&(i=s.getTopicFrame()))return e=i.style.display,i.style.display="none",i.offsetHeight,s.defer(function(){return i.style.display=e,s.delay(function(){return i.offsetHeight,s.delay(function(){return i.offsetHeight},500)},200)})}),o.subscribe(a("EVT_WIDGET_LOADED"),function(){var t,e,i,n;return o.subscribe(a("KEY_MERGED_FILTER_KEY"),function(){return new l.widgets.ExpressionBuilder}),new l.widgets.BrowseSequenceBuilder,r(),l.layoutPrint=window.print,window.print=function(){return o.publish(a("EVT_PRINT_TOPIC"),null)},s.getFileName(document.location.href)===a("TOPIC_FILE")&&(i=u())?i:(n=s.getTopicFrame())?n.onload=function(){return o.publish(a("EVT_TOPIC_LOADED"),null)}:(e=s.extractParamString(document.location.href),t=s.urlParams(e),a("RHMAPNO")in t?document.location=a("TOPIC_FILE")+"?"+e:void 0)}),o.subscribe(a("EVT_BOOKMARK")+"#content_top_placeholder",function(){return o.publish(a("EVT_SCROLL_TO_TOP"),null)}),o.subscribe(a("KEY_PROJECT_LIST"),function(){return l.filterObject=new l.MergeProj}),o.subscribe(a("EVT_PROJECT_LOADED"),function(){return"deviceready",document.addEventListener("deviceready",function(){if(null!=window.cordova)return o.publish(a("KEY_MOBILE_APP_MODE"),!0)})})}.call(this),function(){var t,u,l,o,e;e=window.rh,o=e.model,u=e._,l=e.consts,t=function(){var s,a;function t(){this.tagCombs=[],this.idmap={},this.filter=[],this.grpType="group",this.dataLoaded=!1,this.loadTagData(o.get(l("KEY_PROJECT_LIST"))),this.caption=this.type=this.defFilter=void 0}return t.prototype.updateTagCombs=function(t){var e,i;if(null!=(i=o.get(l("KEY_PROJECT_TAG_COMBINATIONS"))))return t=u.parseProjectName(t),null!=(e=this.idmap)[t]?e[t]:e[t]=i},t.prototype.lookup=function(t,e,i){var n,r,o,s,a;if(null==i&&(i=!0),null!=t&&null!=e)for(s=0,a=t.length;s<a&&(null==(n=t[s])||(r=n.name||n.display,i===(null!=n.children)&&r===e?o=n:null==n.children||i||(o=this.lookup(n.children,e,i)),null==o));s++);return o},s=function(t){return{type:this.grpType,display:t,children:[]}},t.prototype.addTag=function(t,e){var i;if(null==this.lookup(this.filter,e.name,!1))return i={display:e.display,name:e.name},t.push(i)},t.prototype.addGroup=function(t){var e,i,n,r,o;for(null==(i=this.lookup(this.filter,t.display))&&(i=s(t.display),this.filter.push(i)),n=0,r=(o=t.children).length;n<r;n++)null!=(e=o[n])&&null==e.children&&this.addTag(i.children,e);if(0===i.children.length&&-1<this.filter.indexOf(i))return this.filter.splice(this.filter.indexOf(i),1)},t.prototype.updateFilter=function(){var t,e,i,n,r;for(t=o.get(l("KEY_TEMP_DATA"))||[],this.caption||(this.caption=t.caption),this.type||(this.type=t.type),void 0===this.defFilter&&(this.defFilter=t.default),t=t.tags||[],o.publish(l("KEY_TEMP_DATA")),r=[],i=0,n=t.length;i<n;i++)null!=(e=t[i])&&(null!=e.children?r.push(this.addGroup(e)):r.push(this.addTag(this.filter,e)));return r},a=function(t,e){if(this.updateTagCombs(t),this.updateFilter(),!e)return o.publish(l("KEY_MERGED_FILTER_KEY"),this.filter),o.publish(l("KEY_MERGED_PROJECT_MAP"),this.idmap),o.publish(l("KEY_PROJECT_FILTER_CAPTION"),this.caption),o.publish(l("KEY_PROJECT_FILTER_TYPE"),this.type),o.publish(l("KEY_DEFAULT_FILTER"),this.defFilter),this.dataLoaded=!0},t.prototype.loadTagData=function(t){var e,i,n,r,o;if(!this.dataLoaded){for(e=t.length,o=[],i=0,n=t.length;i<n;i++)null!=(r=t[i])?(r&&(r+="/"),o.push(u.loadScript(""+r+l("PATH_PROJECT_TAGDATA_FILE"),!1,a.bind(this,r,--e)))):o.push(void 0);return o}},t}(),e.MergeProj=t}.call(this),function(){var t,o,n,l,r,s,e=function(t,e){return function(){return t.apply(e,arguments)}};l=window.rh,o=l._,l.$,n=l.consts,r=l.storage,s=l._params.filter,t=function(){function t(t){this.handleTagStates=e(this.handleTagStates,this),this.getUnchecked=e(this.getUnchecked,this),r.init(n("HELP_ID")),this.allTagNames=this.computeNames(l.model.get(n("KEY_MERGED_FILTER_KEY"))),this.prepareTagStates(),this.handleTagStates(l.model.get(n("KEY_PROJECT_TAG_STATES"))),l.model.subscribe(n("KEY_PROJECT_TAG_STATES"),o.debounce(this.handleTagStates,300),{initDone:!0})}return":",";",",",t.prototype.computeNames=function(t){return o.reduce(t,function(t,e){return t.push(e.children?this.computeNames(e.children):e.name),t},[],this)},t.prototype.getUnchecked=function(t,e){return o.filter(this.allTagNames[t],function(t){return-1===e.indexOf(t)})},t.prototype.computeExpression=function(t){var e;return t&&this.allTagNames?(e=o.reduce(t,function(t,e,i){var n;return o.isString(e)?t.push({c:[e],u:[]}):null!=e&&(n=o.compact(e))&&0<n.length&&t.push({c:n,u:this.getUnchecked(i,n)}),t},[],this),l.model.publish(n("KEY_TAG_EXPRESSION"),e)):l.model.publish(n("KEY_TAG_EXPRESSION"),[])},t.prototype.handleTagStates=function(t){return null==t&&(t={}),this.computeExpression(t),r.persist("tag_states",t)},t.prototype.prepareTagStates=function(){return l.model.subscribe(n("KEY_PROJECT_FILTER_TYPE"),(i=this,function(){var t,e;if(s&&(t=l.model.get(n("KEY_MERGED_FILTER_KEY")),e=i.parseUrlFilter(t,s.split(","))),e&&e[0]==l.consts("CAMERA_EMULATOR_NAME")&&(s=e=null,window.loadTopic(l.consts("LANGUAGE_DIR")+l.consts("CAMERA_EMULATOR_TOPIC"))),e||(e=r.fetch("tag_states")),e||(e=o.clone(l.model.get(n("KEY_DEFAULT_FILTER")))),s&&(o.isEmptyObject(e)||o.isEmptyObject(e[0])?(e=o.clone(l.model.get(n("KEY_DEFAULT_FILTER"))),window.loadTopic(l.consts("LANGUAGE_DIR")+l.consts("ERROR_TOPIC"))):-1===document.location.href.indexOf("#t")&&o.isEmptyString(getUrlParameter(RHMAPID))&&window.loadTopic(l.consts("LANGUAGE_DIR")+Object.values(e[0])[0].replace("_","-")+".htm")),e)return l.model.publish(n("KEY_PROJECT_TAG_STATES"),e)}));var i},t.prototype.parseFilterElemnt=function(t,e){var i,n,r;return r=e.split(":"),n=r[0],i=r[1]&&r[1].split(";"),{index:o.findIndex(t,function(t){return null!=i==(null!=t.children)&&t.display===n}),elements:i}},t.prototype.parseUrlFilter=function(s,t){var a,u;if(t||t.length)return u="radio"===l.model.get(n("KEY_PROJECT_FILTER_TYPE")),a=!0,o.reduce(t,function(t,e,i){var n,r,o;if(i=(o=this.parseFilterElemnt(s,e)).index,n=o.elements,-1!==i)(r=s[i]).children?t[i]=this.parseUrlFilter(r.children,n):u&&!a||(a=!1,t[i]=r.name);else if(e==l.consts("CAMERA_EMULATOR_NAME"))return e;return t},{},this)},t}(),l.widgets.ExpressionBuilder=t}.call(this),function(){var t,o,s;s=window.rh,o=s._,s.$,t=function(){var t,e;t=function(t){var e,i,n,r;if(null!=(e=s.model.get("t.brsmap")))return n=e.n&&e.n[0]||"",r=e.p&&e.p[0]||"",i=window.decodeURI(document.location.href),o.isEmptyString(n)||(n=window._getRelativeFileName(i,n)),o.isEmptyString||(r=window._getRelativeFileName(i,r)),s.model.publish("l.brsBack",r),s.model.publish("l.brsNext",n)},e=function(){var t,e,i,n;return n=s.model.get(s.consts("KEY_UI_MODE")),e=s.model.get("l.brsBack"),t=s.model.get("l.brsNext"),i=!(n||!e&&!t),s.model.publish("l.show_brs",i)},s.model.subscribe("t.topicurl",o.debounce(t,200)),s.model.subscribe("t.brsmap",o.debounce(t,200)),s.model.subscribe("l.brsBack",e),s.model.subscribe("l.brsNext",e),s.model.subscribe(s.consts("KEY_UI_MODE"),e)},s.widgets.BrowseSequenceBuilder=t}.call(this),function(){var n,r,o,t,e,i,s;t=window.rh,n=t._,t.$,r=t.consts,o=t.model,e=t.rhs,i=null,i=o.subscribe(r("KEY_TAG_EXPRESSION"),(s=!1,function(){if(i&&i(),!s)return s=!0,o.subscribe(r("KEY_SEARCHED_TERM"),function(){return o.publish(r("KEY_ONSEARCH_TAG_EXPR"),JSON.stringify(o.get(r("KEY_TAG_EXPRESSION"))))})})),o.subscribe(r("EVT_SEARCH_TERM"),function(){var t,e,i;return t=o.get(r("KEY_CAN_HANDLE_SEARCH")),i=o.get(r("KEY_SEARCH_TERM"))||null,(e={})[r("HASH_KEY_RH_SEARCH")]=i,e[r("HASH_KEY_UIMODE")]="search",!0!==t?document.location=window.gRootRelPath+"/"+(window.gSearchPageFilePath||r("START_FILEPATH"))+"?#"+n.mapToEncodedString(e):(o.publish(r("EVT_QUERY_SEARCH_RESULTS"),!0),n.defer(function(){return n.updateHashMap(e,!0)}))}),o.subscribe(r("EVT_PROJECT_LOADED"),function(){return window.readSetting&&window.readSetting(RHANDSEARCH,function(t){return o.publish(r("KEY_AND_SEARCH"),t)}),o.subscribe(r("KEY_AND_SEARCH"),function(t){return saveSetting(RHANDSEARCH,"1"===t?"1":"0",!0)})}),o.subscribe(r("EVT_QUERY_SEARCH_RESULTS"),function(){if(!e.doSearch())return window.doSearch()})}.call(this),function(){var e,t,i;(i=window.rh)._,e=i.$,t=i.consts,i.model.subscribe(t("EVT_WIDGET_BEFORELOAD"),function(){var t;if(null!==e("a.wShow",0))return t=e(".contenttopic",0),e.setAttribute(t,"data-rhwidget","Basic"),e.setAttribute(t,"data-class","govt_csh:@.l.csh_mode;govt_nocsh:!@.l.csh_mode")})}.call(this),function(){var n,t,s,a,e,i=function(t,e){return function(){return t.apply(e,arguments)}};e=window.rh,s=e._,n=e.$,a=e.consts,t=function(){var t;function e(t){this.widget=t,this.click=i(this.click,this)}return"group","item",t=a("KEY_PROJECT_FILTER_TYPE"),e.prototype.click=function(t){var e,i,n,r,o;return o=t.currentTarget,e=t.target,i=this.getItemNode(e,o),r=""+a("KEY_PROJECT_TAG_STATES")+this.getItemKey(i),n=this.widget.get(r),"radio"!==this.filterType()?this.handleCheckboxClick(i,r,n):this.handleRadioClick(i,r,n),s.preventDefault(t)},e.prototype.handleRadioClick=function(t,e,i){var n,r,o;if(!this.isGroupNode(t)&&!i)return r=(o=s.splitKey(e)).parentKey,(n={})[o.key]=this.getItemValue(t),this.widget.publish(r,n)},e.prototype.handleCheckboxClick=function(t,e,i){var n;return n=this.isGroupNode(t)?s.any(i,function(t){return t})?void 0:this.getGroupItemExprs(t):i?void 0:this.getItemValue(t),this.widget.publish(e,n)},e.prototype.getItemNode=function(t,e){return s.findParentNode(t,e,function(t){return"LI"===n.nodeName(t)})},e.prototype.getItemValue=function(t){return n.dataset(t,"itemvalue")},e.prototype.getGroupItemExprs=function(t){var e,i;return i=n.dataset(t,"itemkey"),e=this.widget.get(""+this.widget.key+i),s.map(e.children,function(t){return t.name})},e.prototype.getItemKey=function(t){return n.dataset(t,"itemkey")},e.prototype.isGroupNode=function(t){return n.hasClass(t,"group")},e.prototype.isItemNode=function(t){return n.hasClass(t,"item")},e.prototype.class=function(t){return t.children?"group":"item"},e.prototype.value=function(t){return t.children?null:t.name},e.prototype.filterType=function(){return this.widget.get(t)||"checkbox"},e.prototype.inputType=function(t){var e;return e=this.filterType(),t.children&&"radio"===e&&(e=void 0),e},e}(),e.controller("FilterController",t)}.call(this),function(){var t,g=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){var i,r,n,o,e,s,a,u,l,h,c,d,_,p,f,v;function t(t){var e;this.widget=t,this.triggerDelayLoadWidgets=g(this.triggerDelayLoadWidgets,this),this.init(),this.subscribeActiveTab(),this.subscribeToLocations(),this.subscribeScreens(),this.widget.subscribe(d("EVT_PROJECT_LOADED"),(e=this,function(){return e.subscribeUIMode(),e.subscribeMergedFilter(),e.subscribeTopicClick(),e.subscribeTopicScroll(),e.subscribForSearchResult(),e.subscribeTopicNavigate(),e.subscribeToDelayLoadEvents(),e.widget.publish(d("KEY_IFRAME_EVENTS"),{click:!0,scroll:!1})}))}return p=window.rh,c=p._,p.$,d=p.consts,n=d("KEY_FEATURE"),o=d("KEY_FILTER_LOCATION"),s=d("KEY_SEARCH_LOCATION"),r=d("KEY_ACTIVE_TAB"),u=d("KEY_UI_MODE"),e=d("KEY_MOBILE_TOC_DRILL_DOWN"),a=d("KEY_TOC_DRILL_DOWN"),i="desktop",h="tablet","phone",l="filter"!==p._params.hideUI,v={desktop:["toc","idx","glo","filter","fts"],tablet:["toc","idx","glo","filter","fts"],phone:["toc","idx","glo","filter","fts"]},f={desktop:["toc","idx","glo","filter","fts"],tablet:["toc","idx","glo","filter","fts"],phone:["toc","idx","glo"]},_={idx:{evt:"EVT_LOAD_IDX",f_key:"delay_load_idx"},glo:{evt:"EVT_LOAD_GLO",f_key:"delay_load_glo"}},t.prototype.init=function(){return this.screens=this.widget.get(d("KEY_SCREEN_NAMES")),p.storage.init(d("HELP_ID")),this.activeScreen=c.find(this.screens,function(t){return this.widget.get(d("KEY_SCREEN")+"."+t+".attached")},this),null==this.activeScreen&&(this.activeScreen=this.widget.get(d("KEY_DEFAULT_SCREEN"))),this.assureLocations(this.activeScreen),this.initDefauls(),this.initActiveTab()},t.prototype.initDefauls=function(){var e;return e=this.widget.get(d("KEY_DEFAULT_TAB")),this.hasFeature(e)||(e=null),this.defaultTabs={},c.each(this.screens,function(t){return v[t]=c.filter(v[t],function(t){return this.hasFeature(t)},this),f[t]=c.filter(f[t],function(t){return this.hasFeature(t)},this),this.defaultTabs[t]=e&&-1!==v[t].indexOf(e)?e:v[t][0]},this)},t.prototype.initActiveTab=function(){var t;if(void 0!==(t=p.storage.fetch("activetab"))&&t&&this.hasFeature(t))return this.widget.publish(r,t)},t.prototype.isValidTab=function(t,e){return null==e&&(e=this.activeScreen),!(!t||!this.hasFeature(t))&&((e!==i||!("filter"===t&&"content"===this.widget.get(o)||"fts"===t&&"content"===this.widget.get(s)))&&-1!==v[e].indexOf(t))},t.prototype.defaultTab=function(t){var e;return null==t&&(t=this.activeScreen),e=this.defaultTabs[t],this.isValidTab(e)||(e=c.find(v[t],function(t){return this.isValidTab(t)},this)),e},t.prototype.assureValidActiveTab=function(t){var e;if(null==t&&(t=this.activeScreen),e=this.widget.get(r),t===i||e)return this.isValidTab(e)||(e=this.defaultTab()),this.widget.publish(r,e)},t.prototype.toggleSideBar=function(){return this.widget.get(r)?this.widget.publish(r,null):this.widget.publish(r,this.lastMobileTab||this.defaultTab())},t.prototype.toggleActiveTab=function(t){return this.widget.publish(r,this.isDesktopScreen()||t!==this.widget.get(r)?t:null)},t.prototype.triggerDelayLoadWidgets=function(t){var e;if((e=_[t])&&this.hasFeature(e.f_key))return this.widget.publish(d(e.evt),!0)},t.prototype.subscribeToDelayLoadEvents=function(){return this.widget.subscribe(r,this.triggerDelayLoadWidgets)},t.prototype.filterDone=function(){return this.widget.publish(r,this.searchMode?"fts":null)},t.prototype.hasFeature=function(t){return void 0===t||!1!==this.widget.get(n+"."+t)},t.prototype.subscribeUIMode=function(){var e,t,i,n;if(e=function(){if(t.isValidTab("fts"))return t.isDesktopScreen()&&"tabbar"!==t.widget.get(s)?void 0:t.widget.publish(r,"fts")},(t=this).widget.subscribe(u,(i=this,function(t){return i.widget.publish("active_content",t)})),this.widget.subscribe("active_content",(n=this,function(t){return n.isMobileScreen()&&!t?n.widget.publish(r,null):"search"===t?e():void 0}),{initDone:!0}),"search"===this.widget.get("active_content"))return e()},t.prototype.subscribeMergedFilter=function(){var e,i;if(this.widget.get(e=n+".filter"))return this.widget.subscribe(d("KEY_MERGED_FILTER_KEY"),(i=this,function(t){return i.widget.publish(e,!!(t&&t.length&&l)),i.assureValidActiveTab()}))},t.prototype.subscribeTopicClick=function(){return this.widget.subscribe(d("EVT_CLICK_INSIDE_IFRAME"),(t=this,function(){if("phone"===t.activeScreen&&t.widget.get(r))return t.toggleSideBar()}));var t},t.prototype.subscribeTopicNavigate=function(){return this.widget.subscribe(d("EVT_NAVIGATE_TO_URL"),(e=this,function(t){if(t.absUrl&&c.isUrlAllowdInIframe(t.absUrl))return e.widget.publish("active_content",null)}));var e},t.prototype.subscribeTopicScroll=function(){return this.widget.subscribe(d("EVT_SCROLL_INSIDE_IFRAME"),(n=this,function(t){var e,i;return e="down"===t.dir||10<t.scrollTop,n.widget.publish("hide_header",e),i="down"===t.dir&&10<t.scrollTop,n.widget.publish("hide_mobile_functions",i)}));var n},t.prototype.subscribeActiveTab=function(){return this.widget.subscribe(r,(e=this,function(t){return p.storage.persist("activetab",t),e.isMobileScreen()?(e.isSidebarTab(t)&&(e.lastMobileTab=t),e.searchMode="fts"===t||e.searchMode&&"filter"===t):e.searchMode=!1}));var e},t.prototype.subscribeScreens=function(){return c.each(this.screens,function(e){var t,i;return t=d("KEY_SCREEN")+"."+e+".attached",this.widget.get(t)&&this.handleScreen(!0,e),this.widget.subscribe(t,(i=this,function(t){return i.handleScreen(t,e)}),{initDone:!0})},this)},t.prototype.subscribeToLocations=function(){var t,e;return this.widget.subscribe(s,(t=this,function(){return t.assureValidActiveTab(t.activeScreen)})),this.widget.subscribe(o,(e=this,function(){return e.assureValidActiveTab(e.activeScreen)}))},t.prototype.subscribForSearchResult=function(){var e,i,t;return e=function(){var t,e;if(e=i.widget.get(d("KEY_TAG_EXPRESSION")),(t=i.widget.get(d("KEY_ONSEARCH_TAG_EXPR")))&&t!==JSON.stringify(e))return i.widget.publish(d("EVT_SEARCH_TERM"),!0)},(i=this).widget.subscribe(d("KEY_TAG_EXPRESSION"),c.debounce((t=this,function(){if((!t.isValidTab("fts")||"fts"===t.widget.get(r))&&t.isSearchMode(t.widget.get(r)))return e()}),300)),this.widget.subscribe(r,function(t){if("fts"===t)return e()})},t.prototype.isMobileScreen=function(){return"phone"===this.activeScreen},t.prototype.isDesktopScreen=function(){return this.activeScreen===i},t.prototype.isTabletScreen=function(){return this.activeScreen===h},t.prototype.isSidebarTab=function(t){return t&&-1!==f[this.activeScreen].indexOf(t)},t.prototype.isSearchMode=function(t){var e;return e=this.widget.get("active_content"),"fts"===t||"search"===e&&this.isDesktopScreen()&&"content"===this.widget.get(s)},t.prototype.handleScreen=function(t,e){return t?(this.activeScreen=e,this.handleAttached(e)):this.handleDetached(e)},t.prototype.handleDetached=function(t){return c.defer((e=this,function(){if(t===i)return e.widget.publish(r,"search"===e.widget.get("active_content")&&e.isValidTab("fts")?"fts":null)}));var e},t.prototype.handleAttached=function(t){return this.assureLocations(t),this.assureValidActiveTab(t),this.assureTOCMode(t)},t.prototype.assureLocations=function(t){return null==t&&(t=this.activeScreen),this.widget.publish(s,t===i?this.widget.get(d("KEY_DEFAULT_SEARCH_LOCATION")):t===h?"tabbar":"content"),this.widget.publish(o,t===i||t===h?"tabbar":"content")},t.prototype.assureTOCMode=function(t){return null==t&&(t=this.activeScreen),this.widget.publish(a,t!==i&&this.widget.get(e))},t.prototype.newSearch=function(t,e,i){if(13===e&&(this.widget.get(d("KEY_SEARCH_TERM"))!==t&&this.widget.publish(d("KEY_SEARCH_TERM"),t),this.widget.publish(d("EVT_SEARCH_TERM"),!0),null!=i?i.target:void 0))return i.target.blur()},t.prototype.isTagStatesChanged=function(){var t,e;return t=c.compactObject(this.widget.get(d("KEY_PROJECT_TAG_STATES"))),e=c.compactObject(this.widget.get(d("KEY_DEFAULT_FILTER"))),!c.isEqual(t,e)},t.prototype.setDefaultTagStates=function(){var t;return t=this.widget.get(d("KEY_DEFAULT_FILTER")),this.widget.publish(d("KEY_PROJECT_TAG_STATES"),c.clone(t))},t}(),window.rh.controller("ModernLayoutController",t)}.call(this),function(){var t,n,r,e;e=window.rh,n=e.$,r=e._,t=function(e,t){var i;i=(null!=t?t.removeClasses:void 0)||["hide-children","loading"],r.each(i,function(t){return n.removeClass(e.node,t)}),r.each(null!=t?t.addClasses:void 0,function(t){return n.addClass(e.node,t)})},window.rh.controller("JsLoadingController",t)}.call(this),function(){var t,n,r,o,e,s,i,a,u,l;e=window.rh,n=e._,o=e.model,r=e.consts,u=[],l=[],a=0,i=function(t){var e;return e=t+"/projectdata.js",window.xmlJsReader.loadFile(e,function(t,i){var e;if(a++,null!=t&&(e=t.getElementsByTagName("project")[0].getElementsByTagName("remote")).length,n.each(e,function(t){var e;return e=i+"/"+t.getAttribute("url"),u.push(e),l.push(e)}),s(),0===l.length&&a===u.length)return o.publish(r("KEY_PROJECT_LIST"),u),o.publish(r("KEY_MASTER_PROJECT_LIST"),["."])},t)},s=function(){var t,e;for(e=[];0<l.length;)t=l.splice(0,1),e.push(i(t));return e},t=function(){u.push("."),l.push("."),s()},o.subscribe(r("EVT_PROJECT_LOADED"),function(){return n.defer(function(){if(!o.get(r("KEY_PUBLISH_MODE"))&&!window.gbPreviewMode)return new t})})}.call(this),function(k,S,t){"use strict";var w=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}();function _(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function O(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}!function o(s,a,u){function l(i,t){if(!a[i]){if(!s[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(h)return h(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var r=a[i]={exports:{}};s[i][0].call(r.exports,function(t){var e=s[i][1][t];return l(e||t)},r,r.exports,o,s,a,u)}return a[i].exports}for(var h="function"==typeof require&&require,t=0;t<u.length;t++)l(u[t]);return l}({1:[function(t,e,i){var h=k.rh,d=h._,_=(h.$,h.consts),p=h.model,c=_("HASH_KEY_RH_SEARCH"),f=_("HASH_KEY_TOPIC"),v=_("HASH_KEY_UIMODE"),g=_("HASH_KEY_RH_TOCID"),E=_("HASH_KEY_RH_HIGHLIGHT"),y=_("HASH_KEY_RANDOM"),m=[E,_("HASH_KEY_RH_SYNS"),g],l=d.queueUpdateHashMap,b=function(t){return null==t&&(t={}),t[v]=null,t[y]=null,t[g]||(t[g]=null),t[E]||(t[E]=null),t},T=function(t,e){t=d.fixRelativeUrl(t);var i=d.urlParams(d.extractParamString(t));return i[f]=d.stripParam(t),i=b(i),l(i,e)},n=function(t){var e=void 0,i=t.newMap,n=t.oldMap,r=n[v],o=i[v];if(c in i){var s=i[c];e=s!==p.get(_("KEY_SEARCHED_TERM")),p.publish(_("KEY_SEARCH_TERM"),s,{sync:!0})}if("search"===o&&e&&k.gHost&&p.publish(_("EVT_QUERY_SEARCH_RESULTS"),!0),!o||i[f]){var a=void 0,u=p.get(_("KEY_TOPIC_IN_IFRAME"));f in i&&(a=i[f]),a||(a=u);var l=h.model.get(h.consts("KEY_FEATURE"));a||l&&!1===l.showDefTopic||(a=null!=k.gDefaultTopic?k.gDefaultTopic.substring(1):void 0),a&&(a!==u||r!==o||n[E]!==i[E]||n[g]!==i[g])&&(d.stripBookmark(a)!==d.stripBookmark(u)&&d.runTopicLoadingAnimation(!0),p.publish(_("KEY_TOPIC_IN_IFRAME"),a),k.loadTopic(function(t,e){e=e;var i=d.filePath(e),n=d.extractHashString(e);0<n.length&&(n="#"+n);var r=d.urlParams(d.extractParamString(e)),o=!0,s=!1,a=void 0;try{for(var u,l=Array.from(m)[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var h=u.value;null!=t[h]&&(r[h]=t[h])}}catch(t){s=!0,a=t}finally{try{!o&&l.return&&l.return()}finally{if(s)throw a}}p.get(_("KEY_SCREEN_IOS"))&&(r[y]=d.uniqueId());var c=d.mapToEncodedString(r);return 0<c.length&&(c="?"+c),""+i+c+n}(i,a)))}return p.publish(_("KEY_UI_MODE"),i[v])},r=function(t){var e=d.hashParams();if(t&&!e[v]){var i=decodeURI(S.location.href),n=k._getRelativeFileName(i,t),r=e[f];if(!r||d.filePath(n)!==d.filePath(r))return p.publish(_("KEY_TOPIC_IN_IFRAME"),n),T(n,!1)}},o=function(t){var e=t.absUrl;if(!d.isRootUrl()){if(!d.isRootUrl(e)){var i=void 0,n=void 0,r=d.getRootUrl();d.isExternalUrl(e)?n=e:(i=d.getParamsForRoot(e),n=d.fixRelativeUrl(d.makeRelativePath(e,r))),e=""+r+i+"#t="+encodeURIComponent(n)}return S.location.href=e}if(!d.isUrlAllowdInIframe(e))return o=!0,(s={})[f]=e,s=b(s),l(s,o);if(e=d.makeRelativeUrl(d.fixRelativeUrl(e)),d.isHomeUrl(e))return S.location.href=e;var o,s,a=e&&d.filePath(e);if(a===_("START_FILEPATH")?e=e.substring(a.length):e||(e="#ux"),"#"===e[0]||"?"===e[0]){var u=d.hashParams(d.extractHashString(e));return v in u||(u[v]=null),l(u,!0)}return e?T(e,!0):void 0};p.subscribe(_("EVT_WIDGET_LOADED"),function(){return d.addEventListener(S,"click",d.hookClick),p.subscribe(_("EVT_HASH_CHANGE"),n),p.subscribe(_("KEY_TOPIC_URL"),r),p.subscribe(_("EVT_NAVIGATE_TO_URL"),o),p.subscribe(_("KEY_TOPIC_IN_IFRAME"),function(t){if(""+k.gHost+k.gHostPath!="/"&&(k.setTopic&&k.setTopic(),k.changeTopicLink))return k.changeTopicLink(S.location.toString())}),p.subscribe(_("EVT_TOPIC_LOADED"),function(){return d.runTopicLoadingAnimation(!1)}),p.subscribe(_("EVT_INSIDE_IFRAME_DOM_CONTENTLOADED"),function(){return d.runTopicLoadingAnimation(!1)})})},{}],2:[function(t,e,i){var r,n=k.rh,o=n.model,s=n._,a=n.consts,u=(n.http,r=void 0,(u=function(t){function i(t){O(this,i);var e=p(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.data=[],e.chunkCount=0,e.count=0,e.keys="",e.alhpabet="",e.loadNavData("glo"),e.filter="",e.widget=t,e.widget.publish("show",{}),e}return f(i,n.NavController),w(i,null,[{key:"initClass",value:function(){r="entrys"}}]),w(i,[{key:"addElement",value:function(t,e){var i,n=this;return i=[],s.each(t[r],function(t){null!=t&&(n.lookup(e,t)?i.push(void 0):i.push(e.push(t)))},n),i}},{key:"exists",value:function(t){var e=this.alphaText(t);return-1<this.alhpabet.indexOf(e)||(this.alhpabet+=e,!1)}},{key:"isFiltered",value:function(t,e){var i=e?o.get(e):this.filter;return i&&-1===t.toLocaleLowerCase().indexOf(i.toLocaleLowerCase())}},{key:"alphaText",value:function(t){return t.toUpperCase().charAt(0)}},{key:"filterGlo",value:function(t){return this.filter=t.toLocaleLowerCase(),this.alhpabet="",o.publish(a("PROJECT_GLOSSARY_DATA"),o.get(a("PROJECT_GLOSSARY_DATA")))}}]),i}()).initClass(),u);n.controller("GlossaryController",u)},{}],3:[function(t,e,i){var r=k.rh,u=r.model,l=r._,h=r.consts,o=r.http,s=r.rhs,c="topics",n=function(){function t(){O(this,t),this.updateData=this.updateData.bind(this)}return w(t,[{key:"lookup",value:function(t,e){var i=void 0;return null!=t&&null!=e&&l.any(t,function(t){if(null!=t)return e.type===t.type&&e.name===t.name&&l.isEqual(e.url,t.url)&&(i=t),null!=i},this),i}},{key:"sort",value:function(t){return t.sort(function(t,e){return k.compare(t.name,e.name)})}},{key:"updateData",value:function(t,e){var i=u.get(h("KEY_TEMP_DATA"))||[];if(u.publish(h("KEY_TEMP_DATA")),this.addElement(i,this.data,e,this.keys),0==--this.chunkCount&&0===this.count)return this.sort(this.data),u.publish(h(t),this.data)}},{key:"getChunkData",value:function(i,n){this.count--;var t,e,r=(t=u.get(h("KEY_TEMP_DATA")),e=function(t){return t.chunkinfos},(null!=t?e(t):void 0)||[]);return this.chunkCount+=r.length,l.each(r,function(t){var e=this;return i&&(i=l.ensureSlash(i)),l.loadScript(i+"whxdata/"+t.node+".new.js",!1,function(){return e.updateData(n,i)})},this)}},{key:"loadNavData",value:function(i){var e=this;return u.subscribe(h("KEY_PROJECT_LIST"),function(t){return e.alhpabet="",e.count+=t.length,l.each(t,function(t){var e=this;return t&&(t=l.ensureSlash(t)),l.loadScript(t+"whxdata/"+("ndx"===i?"idx":"glo")+".new.js",!1,function(){return e.getChunkData(t,"ndx"===i?"PROJECT_INDEX_DATA":"PROJECT_GLOSSARY_DATA")})},e)})}}]),t}();r.NavController=n;var d,a=(d=void 0,(a=function(t){function i(t){O(this,i);var e=p(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.data=[],e.chunkCount=0,e.count=0,e.alhpabet="",e.filter="",e.keys="keys",e.widget=t,u.subscribeOnce(h("EVT_PROJECT_LOADED"),function(){return e.loadNavData("ndx"),e.getIndexData(),u.subscribe(h("KEY_INDEX_FILTER"),function(){return e.alhpabet=""})}),e}return f(i,r.NavController),w(i,null,[{key:"initClass",value:function(){d=""}}]),w(i,[{key:"addElement",value:function(t,r,o,e){var s,a=this;if(null!=t[e])return s=[],l.each(t[e],function(t){if(null!=t){var e;if(!(e=a.lookup(r,t))){var i={type:t.type,name:t.name};t["data-rhtags"]&&(i["data-rhtags"]=t["data-rhtags"]+"+"+o),t.url||(i[c]=[]);var n=l.makeRelativeUrl(""+o,d);null!=t.url&&(i.url=""+encodeURI(n)+t.url),null==t.url&&(i[a.keys]=[]),r.push(i),e=r[r.length-1]}a.addElement(t,e[a.keys],o,a.keys),s.push(a.addElement(t,e[c],o,c))}},a),s}},{key:"showItem",value:function(t){var e=u.get(h("KEY_INDEX_FILTER"));return!e||-1!==t.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())}},{key:"showCategory",value:function(t,e){if(0<e)return!1;var i=this.alphaText(t);return!(-1<this.alhpabet.indexOf(i)||(this.alhpabet+=i,0))}},{key:"showNextLevel",value:function(t){for(var e=t.getAttribute("data-indexid"),i=_({},e,!this.widget.get("show."+e));e;)i[e=e.substr(0,e.lastIndexOf("_"))]=!0;return this.widget.publish("show",i)}},{key:"alphaText",value:function(t){return t.toUpperCase().charAt(0)}},{key:"getIndexData",value:function(){return u.subscribeOnce(h("KEY_PUBLISH_BASE_URL"),function(){try{var t=u.get(h("KEY_PUBLISH_BASE_URL")),e=S.location.origin,i=t.substr(e.length);if(l.parentPath(l.filePath(l.getRootUrl())),i&&!l.isEmptyString(i)){var n=l.mapToEncodedString(l.extend(l.addPathNameKey({area:s.area(),prj:s.project(),type:s.type(),agt:"ndx",mgr:"agm"})));return o.get(i+"?"+n).success(function(t,e){var i=[],n=[],r=(t=JSON.parse(t)).allProjects,o=t.masterProjects;r.length&&(r[0]=l.ensureSlash(r[0]));var s=function(t,e){return l.each(t,function(t){return e.push(l.makeRelativeUrl(t,r[0]))})};s(r,i),s(o,n);var a=function(t,e,i){l.isEmptyString(t)&&(i[e]=".")};return l.each(i,a),l.each(n,a),u.publish(h("KEY_PROJECT_LIST"),i),u.publish(h("KEY_MASTER_PROJECT_LIST"),n)})}}catch(t){if(r._debug)return r._d("warn",t.message)}})}}]),i}()).initClass(),a);r.controller("IndexController",a)},{}],4:[function(t,e,i){t("../../src/lib/rh")._.findEditDist=function(t,e){if(t==e)return 0;for(var i=[],n=[],r=0;r<e.length+1;r++)i.push(r),n.push(0);for(r=0;r<t.length;r++){n[0]=r+1;for(var o=0;o<e.length;o++){var s=void 0;s=t[r]==e[o]?0:1,n[o+1]=Math.min(n[o]+1,i[o+1]+1,i[o]+s)}for(o=0;o<i.length;o++)i[o]=n[o]}return n[n.length-1]}},{"../../src/lib/rh":8}],5:[function(t,e,i){var n,v=function(t,e){return function(){return t.apply(e,arguments)}},g=t("../../src/lib/rh"),E=t("../../src/responsive_help/utils/node_utils"),y=g._,m=g.$,b=g.model,T=g.consts,k=T("KEY_TOC_DRILL_DOWN"),S=void 0;S=function(){function t(){O(this,t)}return w(t,[{key:"sync",value:function(e,t){var i,n;return e.updateActiveBookInfo(0,"_"),i=e.widget.node,this.reset(t),this.syncToProjectToc(e,i.children,(n=this,function(t){return n.syncToTocItem(e,t)}))}},{key:"reset",value:function(t){var e;return this.parseTocInfo(t),e=this.order.lastIndexOf("@"),this.parentOrder=-1!==e?this.order.substring(0,e):""}},{key:"parseTocInfo",value:function(t){var e=void 0;return this.order=t.childOrder||"",e=y.splitAndTrim(t.childPrefix,"."),this.tocPath=y.reduce(e,function(t,e){var i,n=void 0;return(i=(n=y.splitAndTrim(e,"@")).shift())&&t.push({bookNo:y.parseInt(i,0),order:0<n.length?"@"+n.join("@"):""}),t},[]),e=y.splitAndTrim(t.topicID||"0","_"),this.bookNos=y.map(e.shift().split("."),function(t){return y.parseInt(t,0)}),this.pageNo=y.parseInt(e.shift(),0)}},{key:"syncToProjectToc",value:function(i,n,r){var o,e=void 0,s=void 0,a=void 0;if(0<this.tocPath.length){if(e=0,a=this.tocPath.shift(),-1!==(s=y.findIndex(n,function(t){return!((m.dataset(t,"childorder")||"")!==a.order||!i.isBookNode(t)||++e!==a.bookNo)})))return i.openBook(n[s],!0,(o=this,function(){return y.defer(function(){var t,e;if(e=(t=n[s+1]).children&&t.children[0])return o.syncToProjectToc(i,e.children,r)})}))}else if(r)return r(n)}},{key:"syncToTocItem",value:function(r,t,o){var s,a=void 0,u=void 0,l=void 0;return null==o&&(o=1),a=u=0,l=null,y.any(t,(s=this,function(e){var t=void 0,i=void 0,n=void 0;if((m.dataset(e,"childorder")||"")===s.order&&(r.isBookNode(e)&&(l=t=e),t&&a++,s.bookNos[0]===a)){if(r.isPageNode(e)&&(i=e),i&&u++,1===s.bookNos.length)0===s.pageNo?(n=e,l&&r.openBook(l,!0,function(){return r.updateBookInfo()})):i&&u===s.pageNo&&(n=e),r.updateBookInfo(),n&&(r.selectLink(n,!0,o),m.hasClass(n,"rh-hide")&&!g._params.filter&&b.publish(T("EVT_TOPIC_HIDDEN"),!0));else if(l&&m.hasClass(e,"child"))return s.bookNos.shift(),r.openBook(l,!0,function(){return y.defer(function(){var t;if(t=e.children&&e.children[0])return s.syncToTocItem(r,t.children,700)})}),!0;return null!=n}}))}}]),t}(),n=function(){var e,u,i,r,o,l,h,s,a=void 0,c=void 0,d=void 0;u="expanded",e="collapsing",i="expanding",h="loading-book",s="selected",l="show_child",a="bookid",r="active_bookid",c="level",o="active_level",d=".p.toc";var _="curtoc",p="data-tocitem",f=T("KEY_TOC_BREADCRUMBS"),t=function(){function n(t){var e,i=this;O(this,n),this.widget=t,this.subscribeTopicID=v(this.subscribeTopicID,this),this.onClick=v(this.onClick,this),this.updateBookInfo=v(this.updateBookInfo,this),this._data={},this.projectAbsRef=[],null==this.syncToc&&(this.syncToc=new S),this.widget.publish(c,0),this.widget.publish(a,"_"),g.model.subscribe(d,function(t){i.widget.publish(_,t),i.widget.publish("curlevel",0)}),this.widget.subscribe(T("KEY_TOC_SELECT_ITEM"),this.selectTocItem.bind(this)),b.subscribeOnce([T("EVT_PROJECT_LOADED"),T("KEY_TOC_ORDER")],(e=this,function(){return b.get(T("KEY_PUBLISH_MODE"))?e.getTOCData():e.loadToc(d,"",function(){return e.widget.publish(T("EVT_TOC_LOADED"),!0),e.widget.subscribe(g.consts("KEY_TOPIC_ID"),e.subscribeTopicID)})}))}return w(n,[{key:"expandBook",value:function(t,e,i,n){this.selectTocItem({id:e});var r=m.getAttribute(i,"data-itemkey");g.model.publish("EVT_TOC_LOADEDgototab",{tab:0,key:r,item:n})}},{key:"updateBookInfo",value:function(){var t,e;if(null!=(t=this.widget.get(r))&&t!==this.widget.get(a)&&this.widget.publish(a,t),null!=(e=this.widget.get(o))&&e!==this.widget.get(c))return this.widget.publish(c,e)}},{key:"updateActiveBookInfo",value:function(t,e){return this.widget.publish(r,e),this.widget.publish(o,t)}},{key:"getText",value:function(t){return t.textContent.trim()}},{key:"_getPreviousItemNode",value:function(t){var e=this.pid(m.getAttribute(t,"data-itemid"));return m.find(this.widget.node,'[data-itemid="'+e+'"]')[0]}},{key:"updateBreadcrumbInfo",value:function(t){var e=t,i=void 0,n=[];if(this.isTOCItem(t)){for(n.push(this._createBreadcrumbItem(e));i=this._getPreviousItemNode(e);)n.push(this._createBreadcrumbItem(i)),e=i;n.reverse(),0<n.length&&(n[n.length-1].lastNode=!0),n.curlevel=this.widget.get("curlevel"),this.widget.publish(f,n)}}},{key:"_createBreadcrumbItem",value:function(t){var e=t;this.hasTOCItemLink(t)||(e=this._findFirstLink(t));var i=e&&(m.getAttribute(e,"href")||m.getAttribute(e,"link"))||"#";return{id:m.getAttribute(t,"data-itemid"),text:this.getText(t),url:i,hasUrl:this.hasTOCItemLink(t),lastNode:!1}}},{key:"isTOCItem",value:function(t){return"LI"===m.nodeName(t)||m.getAttribute(t,p)}},{key:"_findFirstLink",value:function(t){var e={that:this},i=E.parentNode(t);return e.bookid=m.getAttribute(t,"data-itemid"),m.traverseNode(i,this._findLinkFn,null,null,e),e.linkNode}},{key:"_isParentTocItem",value:function(t){return this.bookNode!==t&&this.that.isTOCItem(t)}},{key:"_findLinkFn",value:function(t){return m.getAttribute(t,"data-itemid")===this.bookid&&(this.bookFound=!0),!this.bookFound||!this.that.hasTOCItemLink(t)||void 0!==this.linkNode||(this.linkNode=t,!1)}},{key:"nextLevel",value:function(t){var e;return e=y.parseInt(m.dataset(t,"itemlevel"),0),m.hasClass(t,u)?e:e+1}},{key:"onClick",value:function(t){var e,i,n,r;if(r=t.currentTarget,e=t.target,i=this.hasLink(e),n=this.getItemNode(e,r),this.isBookNode(n)&&(i&&this.selectedNode!==n&&this.isOpenBook(n)||(this.toggleBook(n,!1),this.updateBreadcrumbInfo(n))),!(!i||this.isUrlNode(n)&&this.hasExternalLink(e)))return this.selectLink(n,!1)}},{key:"selectLink",value:function(t,e,i){if(null==i&&(i=700),this.selectedNode&&m.removeClass(this.selectedNode,s),e&&this.selectedNode!==t&&y.delay(function(){return t.scrollIntoView(!1)},i),this.selectedNode=t)return this.updateBreadcrumbInfo(t),m.addClass(t,s)}},{key:"selectTocItem",value:function(t){var e=t.id+"_0";if(e){for(var i={},n=-1;e;)n++,i[e]=!0,e=e.substr(0,e.lastIndexOf("_"));this.widget.publish("show_child",i),this.widget.publish("curlevel",n),t.url&&g.model.publish("EVT_TOC_LOADEDgototab",{tab:0,item:{url:t.url}})}}},{key:"getItemNode",value:function(t,e){return y.findParentNode(t,e,this.isTOCItem)}},{key:"getChildItemNode",value:function(t,e){return m.find(t,function(t){return"LI"===m.nodeName(t)||m.getAttribute(t,p)})}},{key:"hasTOCItemLink",value:function(t){return"true"===m.getAttribute(t,"data-haslink")}},{key:"hasLink",value:function(t){var e;return(e=m.getAttribute(t,"href"))&&"#"!==e}},{key:"isBookNode",value:function(t){return m.hasClass(t,"book")}},{key:"isTopicNode",value:function(t){return m.hasClass(t,"item")}},{key:"isUrlNode",value:function(t){return m.hasClass(t,"url")}},{key:"isPageNode",value:function(t){return this.isTopicNode(t)||this.isUrlNode(t)}},{key:"isOpenBook",value:function(t){return this.widget.get(k)?m.hasClass(t,"active"):m.hasClass(t,u)}},{key:"hasExternalLink",value:function(t){var e;return!(!(e=m.getAttribute(t,"href"))||y.isRelativeUrl(e))&&!y.isUrlAllowdInIframe(e)}},{key:"getBookNode",value:function(t,e){var i;return i=this.getItemNode(t,e),this.isBookNode(i)?i:null}},{key:"animateCollapse",value:function(t){return y.each([t,t.nextElementSibling],function(t){return m.addClass(t,e),y.delay(function(){return m.removeClass(t,e)},700)})}},{key:"animateExpand",value:function(t){return y.each([t,t.nextElementSibling],function(t){return m.addClass(t,i),y.delay(function(){return m.removeClass(t,i)},700)})}},{key:"toggleBook",value:function(t,e){return null==e&&(e=!0),this.isOpenBook(t)?this.closeBook(t):this.openBook(t,e)}},{key:"closeBook",value:function(t){var e,i;if(e=m.dataset(t,"itemid"),i=""+l+e,!1!==this.widget.get(i)&&this.widget.publish(i,!1),this.updateActiveBookInfo(this.nextLevel(t),this.pid(e)),this.updateBookInfo(),m.hasClass(t,u))return m.removeClass(t,u),this.animateCollapse(t)}},{key:"openBook",value:function(t,e,i){var n,r,o,s,a;return null==i&&(i=this.updateBookInfo),o=m.dataset(t,"itemkey"),r=m.dataset(t,"itemid"),n=m.dataset(t,"childorder"),s=""+l+r,!0!==this.widget.get(s)&&this.widget.publish(s,!0),this.updateActiveBookInfo(this.nextLevel(t),r),this.widget.get(o)?(m.hasClass(t,u)||(m.addClass(t,u),this.animateExpand(t)),i()):(m.addClass(t,h),e&&t.scrollIntoView(!1),this.loadToc(o,n,(a=this,function(){return m.removeClass(t,h),m.addClass(t,u),a.animateExpand(t),i()})))}},{key:"extractTempData",value:function(){var t;return t=this.widget.get(g.consts("KEY_TEMP_DATA")),this.widget.publish(g.consts("KEY_TEMP_DATA")),t}},{key:"loadToc",value:function(e,i,n){var r,t,o,s,a;return s=this.parseKey(e),r=s.absRef,t=s.key,o=r?r+"/":"",y.loadScript(o+"whxdata/"+t+".new.js",!0,(a=this,function(){var t;return t=a.extractTempData()||[],y.each(t,function(t){if(t.absRef=r,i)return t.childOrder=i}),a.loadRefToc(t,function(t){if(a.widget.publish(e,t),n)return n()})}))}},{key:"loadRefToc",value:function(e,i){var n,r=void 0,o=void 0,t=void 0;if(null==e&&(e=[]),-1!==(o=y.findIndex(e,function(t){if(t.ref)return!0}))){t=e[o],(r=t.absRef||"")&&(r+="/"),r+=t.ref;var s=b.get(T("KEY_TOC_ORDER"))[r].order;return y.loadScript(r+"/whxdata/toc.new.js",!0,(n=this,function(){var t;return t=n.extractTempData()||[],y.each(t,function(t){if(t.absRef=r,s)return t.childOrder=s}),Array.prototype.splice.apply(e,[o,1].concat(t)),n.loadRefToc(e,i)}))}if(i)return i(e)}},{key:"getTOCData",value:function(){return b.subscribeOnce(T("KEY_PUBLISH_BASE_URL"),(i=this,function(){var e;try{return b.subscribe(T("KEY_PROJECT_LIST"),function(o){return b.subscribe(T("KEY_MASTER_PROJECT_LIST"),function(t){var n,r;return r=t.length,n=[],y.each(t,function(e){return(e=y.makeRelativeUrl(e,o[0]))&&(e+="/"),y.loadScript(e+"whxdata/toc.new.js",!0,(i=this,function(){var t;return t=i.extractTempData()||[],y.each(t,function(t){t.absRef=e}),i.loadRefToc(t,function(t){if(r--,n=n.concat(t),0===r)return i.widget.publish(d,n),i.widget.publish(T("EVT_TOC_LOADED"),!0),i.widget.subscribe(g.consts("KEY_TOPIC_ID"),i.subscribeTopicID)})}));var i},i)})})}catch(t){if(e=t,g._debug)return g._d("warn",e.message)}}));var i}},{key:"nextChildOrder",value:function(t){var e=void 0;return(e=t.split("@"))[e.length-1]=1+y.parseInt(e[e.length-1],0),e.join("@")}},{key:"childOrder",value:function(t){return t?t+"@1":"@1"}},{key:"pid",value:function(t){var e=void 0;return(e=t.split("_")).pop(),e.join("_")||"_"}},{key:"key",value:function(e,t){var i=void 0;return null==e&&(e=""),-1===(i=y.findIndex(this.projectAbsRef,function(t){return t===e}))&&(i=this.projectAbsRef.length,this.projectAbsRef.push(e)),".p.child_toc."+i+"."+t}},{key:"parseKey",value:function(t){var e=void 0;return{key:(e=(t=t.substring(3)).split(".")).pop(),absRef:this.projectAbsRef[e.pop()]||""}}},{key:"url",value:function(t,e){var i=void 0,n=void 0,r=void 0,o=void 0;return t.url?(o=""+(t.absRef?y.ensureSlash(t.absRef):"")+t.url,0<(i=y.extractHashString(o)).length&&(i="#"+i,n=y.filePath(o),0<(r=y.extractParamString(o)).length&&(r+="&"),o=""+n+(r="?"+r+"rhtocid="+e)+i),encodeURI(o)):"#"}},{key:"tags",value:function(t){var e;return e=t.absRef?"+"+t.absRef:"",t["data-rhtags"]?t["data-rhtags"]+e:""}},{key:"subscribeTopicID",value:function(e){var t,i=this,n=void 0;null==e&&(e={}),(t=y.hashParams().rhtocid)?(n=this.getPathfromId(t),this.selectTocById(n,this.widget.node)):g.model.subscribe(g.consts("KEY_MASTER_PROJECT_LIST"),function(t){if(t&&t.length<2)return i.syncToc.sync(i,e)})}},{key:"subscribeBookId",value:function(t){var e=void 0;if(t)return e=this.getPathfromId(t),this.selectTocById(e,this.widget.node,null,void 0)}},{key:"getPathfromId",value:function(t){var e=void 0;return(e=t.split("_")).shift(),e=y.map(e,function(t){return y.parseInt(t,0)})}},{key:"selectTocById",value:function(i,t,e,n){var r,o,s=void 0;if((null==e&&(e=1),t&&t.children)&&(s=i.shift(),r=y.find(t.children,function(t){if(this.isBookNode(t)||this.isPageNode(t)){if(0===s)return!0;s--}return!1},this)))return 0===i.length&&this.selectLink(r,!0,e),this.isBookNode(r)?this.openBook(r,!0,(o=this,function(){return y.defer(function(){var t=void 0,e=void 0;return 0===i.length?o.updateBookInfo():(e=(t=r.nextElementSibling).children&&t.children[0],o.selectTocById(i,e,700))})})):this.updateBookInfo()}}]),n}();return t.prototype.class=function(t){return"remoteitem"===t.type?"url":t.type},t}(),g.controller("TocController",n)},{"../../src/lib/rh":8,"../../src/responsive_help/utils/node_utils":37}],6:[function(t,e,i){var n=t("../../src/lib/rh"),r=n._,o=(n.$,n.model),s=n.consts;new(function(){function t(){var i=this;O(this,t),this.data={"":{order:"",nextChild:0}},o.subscribeOnce(s("KEY_PROJECT_LIST"),function(e){r.each(e,function(t){t=r.makeRelativeUrl(i.trimFirst(t,"."),e[0]),i.childOrder(t)}),o.publish(s("KEY_TOC_ORDER"),i.data)})}return w(t,[{key:"trimFirst",value:function(t,e){return t.length&&t[0]===e&&t[1]!==e?t.substring(1):t}},{key:"childOrder",value:function(t){if(t=this.trimFirst(t,"/"),!this.data[t]){var e=t;e=(e=e.substring(0,e.lastIndexOf("/"))).substring(0,e.lastIndexOf("/"));var i=this.data[e];i.nextChild++,this.data[t]={order:i.order+"@"+i.nextChild,nextChild:0}}return this.data[t].order}}]),t}())},{"../../src/lib/rh":8}],7:[function(t,e,i){var n,g=k.rh,r=g.model,o=g._,E=g.consts,s=g.http,a=g.rhs,u=(n=void 0,(u=function(){function t(){O(this,t),r.subscribeOnce(E("EVT_PROJECT_LOADED"),function(){return r.subscribeOnce(E("KEY_PUBLISH_MODE"),function(t){if(t){var e=e||n(),f=[],v=o.debounce(function(){return s.post(e,JSON.stringify(f)).error(function(t,e){if(g._debug)return g._d("error","Filter report status ",e)})},3e3,!1);return r.subscribe(E("KEY_TAG_EXPRESSION"),function(t){f=[];var e=g.model.get(E("KEY_MERGED_FILTER_KEY")),i=!0,n=!1,r=void 0;try{for(var o,s=Array.from(t)[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,u=!0,l=!1,h=void 0;try{for(var c,d=Array.from(a.c)[Symbol.iterator]();!(u=(c=d.next()).done);u=!0){var _,p=c.value;(_=g.filterObject.lookup(e,p,!1))&&f.push(_.display)}}catch(t){l=!0,h=t}finally{try{!u&&d.return&&d.return()}finally{if(l)throw h}}}}catch(t){n=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw r}}if(0<f.length)return v()})}})})}return w(t,null,[{key:"initClass",value:function(){n=function(){var t=S.location.origin,e=r.get(E("KEY_PUBLISH_BASE_URL")).substr(t.length);if(e&&!o.isEmptyString(e))return e+"?"+o.mapToEncodedString(o.extend(o.addPathNameKey({area:a.area(),prj:a.project(),type:a.type(),agt:"fltRpt",mgr:"agm"})))}}}]),t}()).initClass(),u);new u},{}],8:[function(t,e,i){(function(t){void 0===t.rh&&(t.rh={}),e.exports=t.rh}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0!==k?k:{})},{}],9:[function(t,e,i){t("../lib/rh"),t("./layout/ui/carousel"),t("./layout/home_controller"),t("../../lenient_src/layout/search_util"),t("./layout/search/search_controller"),t("./layout/favorites_controller"),t("./layout/toc_breadcrumbs_controller.js"),t("../../lenient_src/layout/toc_order"),t("../../lenient_src/layout/toc_controller"),t("../../lenient_src/layout/index_controller"),t("../../lenient_src/layout/glossary_controller"),t("../../lenient_src/layout/event_handlers"),t("./layout/rh2017layoutcontroller"),t("./layout/modal_dialog"),t("./layout/search_result_controller.js"),t("../../lenient_src/robohelp/layout/filter_handler")},{"../../lenient_src/layout/event_handlers":1,"../../lenient_src/layout/glossary_controller":2,"../../lenient_src/layout/index_controller":3,"../../lenient_src/layout/search_util":4,"../../lenient_src/layout/toc_controller":5,"../../lenient_src/layout/toc_order":6,"../../lenient_src/robohelp/layout/filter_handler":7,"../lib/rh":8,"./layout/favorites_controller":10,"./layout/home_controller":11,"./layout/modal_dialog":12,"./layout/rh2017layoutcontroller":13,"./layout/search/search_controller":30,"./layout/search_result_controller.js":34,"./layout/toc_breadcrumbs_controller.js":35,"./layout/ui/carousel":36}],10:[function(t,e,i){var r=t("../../lib/rh"),n=r.consts,o=function(){function i(t){var e=this;O(this,i),this.widget=t,this.favStorage=new r.Storage,this._loadFromStorage=!1,this._favMemoryStore=void 0,r.model.subscribeOnce(n("EVT_PROJECT_LOADED"),function(){e.init()})}return w(i,[{key:"_getUniqueId",value:function(){function t(t){var e=(Math.random().toString(16)+"000000000").substr(2,8);return t?"-"+e.substr(0,4)+"-"+e.substr(4,4):e}return t()+t(!0)+t(!0)+t()}},{key:"numberOfItems",value:function(t){return Object.keys(t).length}},{key:"_getFavHTMLElements",value:function(t){for(var e=S.getElementsByTagName("div"),i=[],n=0;n<e.length;n++)e[n].getAttribute(r.consts("FAVATTRIBUTE"))===t&&i.push(e[n]);return i}},{key:"getLinkTitle",value:function(t){var e=r.model.get(n("KEY_LNG"));return t?e&&e.unsetAsFavorite||"":e&&e.setAsFavorite||""}},{key:"_loadFavoritesFromStorage",value:function(){var t=this.favStorage.fetch(n("FAVSTORAGE"));return null==t?{}:JSON.parse(t)}},{key:"_loadFavorites",value:function(){return!1===this._loadFromStorage&&(this._favMemoryStore=this._loadFavoritesFromStorage()),this._favMemoryStore}},{key:"_saveFavorites",value:function(){var t;t=JSON.stringify(this._favMemoryStore),this.favStorage.persist(r.consts("FAVSTORAGE"),t)}},{key:"_unFavoriteTopic",value:function(t){for(var e in this._favMemoryStore){if(this._favMemoryStore[e].topic===t){delete this._favMemoryStore[e];break}}this._saveFavorites(),r.model.publish(r.consts("EVENTFAVCHANGE"),null)}},{key:"_favoriteTopic",value:function(t,e){this._favMemoryStore[this._getUniqueId()]={topic:t,title:e},this._saveFavorites(),r.model.publish(r.consts("EVENTFAVCHANGE"),null)}},{key:"getStorageId",value:function(){return"fav-"+r._.getHostFolder()}},{key:"getTopicURL",value:function(){return r.model.get(r.consts("KEY_TOPIC_URL"))}},{key:"getTopicTitle",value:function(){return r.model.get(r.consts("KEY_TOPIC_TITLE"))}},{key:"isTopicFavorite",value:function(t){var e,i=void 0;for(var n in t||(t=this.getTopicURL()),i=!1,e=this._loadFavorites()){if(e[n].topic===t){i=!0;break}}return i}},{key:"setfavoritesTitle",value:function(t){var e=this.getLinkTitle(t);r.model.publish(n("FAVORITES_BUTTON_TITLE"),e)}},{key:"setTopicFavoriteState",value:function(){r.model.publish(n("TOPIC_FAVORITE"),this.isTopicFavorite())}},{key:"setFavoritesList",value:function(){var t=[],e=void 0,i=this._loadFavorites();for(e in i)t.push(i[e]);r.model.publish(n("KEY_FAVORITES"),t)}},{key:"toggleFavorite",value:function(t){t||(t=this.getTopicURL()),this.isTopicFavorite(t)?this._unFavoriteTopic(t):this._favoriteTopic(t,this.getTopicTitle()),this.setTopicFavoriteState()}},{key:"init",value:function(){this.favStorage.init(r._.getRootUrl()),r.model.subscribe(r.consts("KEY_TOPIC_URL"),this.setTopicFavoriteState.bind(this)),r.model.subscribe(r.consts("EVENTFAVCHANGE"),this.setFavoritesList.bind(this)),r.model.subscribe(r.consts("TOPIC_FAVORITE"),this.setfavoritesTitle.bind(this)),this.setFavoritesList(),r.model.publish(n("TOPIC_FAVORITE"),this.isTopicFavorite())}}]),i}();r.controller("FavoritesController",o)},{"../../lib/rh":8}],11:[function(t,e,i){var n=t("../../lib/rh"),r=n._,o=function(){function e(t){O(this,e),this.widget=t}return w(e,[{key:"goToHome",value:function(t){if(n.consts("HOME_FILEPATH")===n._.getFileName())return this.changeToDefaultTopic(t);var e=void 0;return void 0!==t&&""!==t&&(e={rhtocid:t}),r.goToHome(e),!0}},{key:"changeToDefaultTopic",value:function(t){var e={t:k.gDefaultTopic.substring(1)};return void 0!==t&&""!==t&&(e.rhtocid=t),r.queueUpdateHashMap(e,!0),!0}}]),e}();n.controller("HomeController",o)},{"../../lib/rh":8}],12:[function(t,e,i){var n=t("../../lib/rh"),r=t("../utils/node_utils"),o=n.$,s=n._,a=function(){function t(){O(this,t)}return w(t,[{key:"createChildWidget",value:function(){this.node=o.createElement("div",this.template),r.appendChild(S.body,this.node),this.widget=new n.Widget({node:this.node}),this.widget.init()}},{key:"setOnImageLoad",value:function(){var t=o.find(this.node,".rh-modal-content")[0];if(t){this.modalContent=t;var e=o.find(t,"img")[0];e&&((this.img=e).addEventListener("load",this.setModalSize.bind(this)),e.addEventListener("error",this.setModalSize.bind(this)))}}},{key:"setModalSize",value:function(){this.imageWidth=this.img.naturalWidth,this.imageHeight=this.img.naturalHeight;var t=this.calculatePosition(this.imageWidth,this.imageHeight),e=o.find(this.node,".rh-modal-container")[0];e&&this.setContainerStyle(e,t)}},{key:"setContainerStyle",value:function(t,e){var i=Math.round(e.top),n=Math.round(e.left);o.css(t,"left",n.toString()+"px"),o.css(t,"top",i.toString()+"px"),this.modalContent&&this.setImageSize(e.width,e.height),o.css(t,"display","block")}},{key:"calculateImageSize",value:function(t){var e=t.imageWidth/t.imageHeight;return t.imageWidth<t.pageWidth&&t.imageHeight<t.pageHeight?{width:t.imageWidth,height:t.imageHeight}:t.imageWidth>=t.pageWidth&&t.imageHeight<=t.pageHeight?{height:t.pageWidth/e,width:t.pageWidth}:t.imageWidth<=t.pageWidth&&t.imageHeight>=t.pageHeight?{height:t.pageHeight,width:t.pageHeight*e}:t.imageWidth>=t.pageWidth&&t.imageHeight>=t.pageHeight?this._calculateFullyExceedSize(t,e):void 0}},{key:"_calculateFullyExceedSize",value:function(t,e){return e<t.pageWidth/t.pageHeight?{height:t.pageHeight,width:t.pageHeight*e}:{height:t.pageWidth/e,width:t.pageWidth}}},{key:"calculatePosition",value:function(t,e){var i=k.innerWidth||S.body.clientWidth,n=k.innerHeight||S.body.clientHeight,r={imageWidth:t,imageHeight:e,pageWidth:i=0<=(i-=70)?i:0,pageHeight:n=0<=(n-=70)?n:0},o=this.calculateImageSize(r);return t=o.width,e=o.height,{left:Math.max(5,(i-t)/2),top:Math.max(5,(n-e)/2),width:t,height:e,pageWidth:i,pageHeight:n}}},{key:"initialStyle",value:function(){return this.isImage?'style="display:none"':""}},{key:"ShowModal",value:function(t){this.isImage=t.isImage,this.createChildWidget(),this.widget.subscribe("close",this._close.bind(this)),this.widget.publish("content",t.content),s.defer(this.setOnImageLoad.bind(this))}},{key:"setImageSize",value:function(t,e){this.imageWidth>t&&o.css(this.img,"width",Math.round(t)+"px"),this.imageHeight>e&&o.css(this.img,"height",Math.round(e)+"px")}},{key:"_close",value:function(){this.widget.destruct(),this.widget=void 0,r.removeChild(this.node),this.node=void 0}},{key:"template",get:function(){return'\n    <div class="rh-modal">\n        <div class="rh-modal-container" '+this.initialStyle()+'>\n          <div class="rh-modal-content" data-html="content"></div>\n          <div class="rh-modal-close" data-click="@close(true)"> </div>\n        </div>\n    </div>'}}]),t}();n.model.csubscribe("SHOW_MODAL",function(t){(new a).ShowModal(t)})},{"../../lib/rh":8,"../utils/node_utils":37}],13:[function(t,e,i){var o=t("../../lib/rh"),n=o.$,s=o._,a=o.consts,r=function(){function e(t){O(this,e),this.widget=t,this.topicFrame=".topic-container iframe",this.initLayout(),this.initModal()}return w(e,[{key:"isLayoutMode",value:function(t){var e=t||s.hashParams(),i=e[o.consts("HASH_KEY_TOPIC")];return e[o.consts("HASH_KEY_UIMODE")]!==a("HELP_SEARCH_MODE")&&(!i||"true"===e[o.consts("HASH_HOMEPAGE_MODE")]||e[o.consts("HASH_KEY_RH_TOCID")])}},{key:"initLayout",value:function(){var r=this;o.model.subscribe(a("EVT_HASH_CHANGE"),function(t){var e=t.newMap,i=t.oldMap;r.isLayoutMode()?r.widget.publish(o.consts("KEY_VIEW_MODE"),o.consts("HELP_LAYOUT_MODE")):"search"===e[o.consts("HASH_KEY_UIMODE")]?(r.widget.publish(o.consts("KEY_VIEW_MODE"),o.consts("HELP_SEARCH_MODE")),s.queueUpdateHashMap(_({},a("HASH_HOMEPAGE_MODE"),!1),!1)):r.widget.publish(o.consts("KEY_VIEW_MODE"),o.consts("HELP_TOPIC_MODE"));var n=o.model.get(o.consts("KEY_FEATURE"));n&&!1===n.showDefTopic&&!e[o.consts("HASH_KEY_RH_TOCID")]&&!i[o.consts("HASH_KEY_TOPIC")]&&e[o.consts("HASH_KEY_TOPIC")]?s.queueUpdateHashMap(_({},a("HASH_HOMEPAGE_MODE"),"false"),!1):i[o.consts("HASH_KEY_TOPIC")]&&!e[o.consts("HASH_KEY_RH_TOCID")]&&i[o.consts("HASH_KEY_TOPIC")]!==e[o.consts("HASH_KEY_TOPIC")]&&"true"===e[o.consts("HASH_HOMEPAGE_MODE")]&&i[o.consts("HASH_HOMEPAGE_MODE")]===e[o.consts("HASH_HOMEPAGE_MODE")]&&s.queueUpdateHashMap(_({},a("HASH_HOMEPAGE_MODE"),"false"),!1)});var t=s.hashParams();this.isLayoutMode()&&"true"!==t[o.consts("HASH_HOMEPAGE_MODE")]&&s.queueUpdateHashMap(_({},a("HASH_HOMEPAGE_MODE"),!0),!1),o.model.subscribe("EVT_TOC_LOADEDgototab",function(n){n.key&&o.model.subscribe(n.key,function(t,e,i){i(),n.item&&n.item.url&&!t[0].added&&(t.unshift({type:"item",url:n.item.url,name:n.item.name,added:!0}),o.model.publish(n.key,t))}),n.item.url&&r.viewTopicInLayoutMode(n.item.url)})}},{key:"viewTopicInLayoutMode",value:function(t){var e=_({homepage:"true"},o.consts("HASH_KEY_RH_TOCID"),!0);t&&"#"!==t&&(e.t=t),s.queueUpdateHashMap(e,!1)}},{key:"initModal",value:function(){var e=!1;S.addEventListener("keydown",function(t){27===t.keyCode&&o._.each(n.find(".modal"),function(t){n.addClass(t,"rh-hide")})},!1),S.addEventListener("click",function(){e||o._.each(n.find(".modal"),function(t){n.addClass(t,"rh-hide")}),e=!1}),o._.each(n.find(".modal-content"),function(t){s.addEventListener(t,"click",function(){e=!0})})}}]),e}();o.controller("RH2017LayoutController",r)},{"../../lib/rh":8}],14:[function(t,e,i){e.exports={minPreviousThreshold:.2,previousnGram:1,max_predictions:5,PREDICTOR_SOURCE_ID:{HISTORY_PREDICTOR:0,NGRAM_PREDICTOR:1,GENERAL_PREDICTOR:2,CORRECTOR:3}}},{}],15:[function(t,e,i){var o=t("./indices"),r=t("../../../lib/rh")._,s=t("./prediction"),a=t("./consts"),u=t("./utils"),l=t("./prediction_list"),n=function(){function n(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:20;O(this,n),this._loader=t,this.predictions=[],this.max_predictions=i,this._callback=e}return w(n,[{key:"getCorrections",value:function(t){this._parsed_input=t,this.predictions=[],this._computePredictions();var e=this._loader.getHashes(this._parsed_input._partial);if(e)for(var i=e.length,n=0;n<i&&this.predictions.length<this.max_predictions;n++){var r=e[n];this._addCorrection(r)}this.onResultCalculated()}},{key:"clear",value:function(){this.predictions=[]}},{key:"_computePredictions",value:function(){var t=this._loader.getHashes(this._parsed_input._partial);t&&this._addCorrection(t)}},{key:"onResultCalculated",value:function(){this._callback&&this._callback(new l(this.predictions,this._parsed_input),this._loader)}},{key:"_matchCorrection",value:function(t){return this._hamming_dist=this._getDistance(t),this._hamming_dist<=2&&!this._loader.isStopWord(t)}},{key:"_addCorrection",value:function(t){if(t){var e=u.getSafeElement(t,o.MAP.WORD);if(e&&this._matchCorrection(e)){var i=this._parsed_input.replaceLastWord(e),n=this._parsed_input.completeSuggestion(i),r=new s(n,1/this._hamming_dist,2,a.PREDICTOR_SOURCE_ID.CORRECTOR);this.predictions.push(r)}}}},{key:"_getDistance",value:function(t){return r.findEditDist(this._parsed_input._partial,t)}}]),n}();e.exports=n},{"../../../lib/rh":8,"./consts":14,"./indices":20,"./prediction":26,"./prediction_list":28,"./utils":33}],16:[function(t,e,i){var n=function(){function e(t){O(this,e),this._callback=t,this._count=0}return w(e,[{key:"signal",value:function(){this._count++,0<=this._count&&this._callback&&this._callback()}},{key:"wait",value:function(t){var e=t||1;this._count-=e}}]),e}();e.exports=n},{}],17:[function(t,e,i){var r=t("./prediction_list"),o=t("./prediction_creator"),s=t("./consts"),a=t("./indices"),u=t("../../../lib/rh")._,l=t("./merger"),n=function(){function n(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:20;O(this,n),this._max_predictions=i,this._loader=e,this.total_count=this._loader.getTotalCount(),this._callback=t,this._source=s.PREDICTOR_SOURCE_ID.GENERAL_PREDICTOR,this.prediction_merger=new l([],5*this.total_count)}return w(n,[{key:"clear",value:function(){this.prediction_merger.clear(),this.parsed_input=void 0}},{key:"getPredictions",value:function(t){this._init(t),this._computePredictions(),this._onResultComputed()}},{key:"_computePredictions",value:function(){var t=this._getWordHashes();t&&this._addPredictions(t)}},{key:"_isWholeWordInput",value:function(){return this.parsed_input.isWholeWord}},{key:"_getWordHashes",value:function(){return this.parsed_input.isWholeWord?this._loader.top_words:this._loader.getHashes(this.parsed_input._partial)}},{key:"_init",value:function(t){this.prediction_merger=new l([],5*this.total_count),this.parsed_input=t}},{key:"_onResultComputed",value:function(){this._callback&&this._callback(new r(this.predictions,this.parsed_input),this._loader)}},{key:"_addPredictions",value:function(t){if(t)for(var e=t.length,i=0;i<e&&this.predictions.length<this.max_predictions;i++){var n=t[i];this._addWordPrediction(n)}}},{key:"_addWordPrediction",value:function(t,e){e=e||this._matches_partially.bind(this);var i=this._loader.getModelData(t),n=this._loader.total_count;if(e(t)){var r=t[a.MAP.WORD];this._should_add_prediction(r)&&this._create_predictions(t,n,i)}}},{key:"_continueFn",value:function(){return!0}},{key:"_should_add_prediction",value:function(t){return!this._loader.isStopWord(t)&&!this.parsed_input.equalLastWord(t)}},{key:"_matches_partially",value:function(t){if(this.parsed_input.isWholeWord)return!0;var e=t[a.MAP.WORD];return this.parsed_input.comparePartial(e)}},{key:"_create_predictions",value:function(t,e,i){var n=this,r=new o({loader:this._loader,model_item:i,total_count:e,parsed_input:this.parsed_input,continueFn:this._continueFn}).getMultiPredictions(t,!0,void 0,this._source);u.each(r,function(t){void 0!==t&&n.prediction_merger.mergePrediction(t)})}},{key:"_calculate_probability",value:function(t){return t/this.total_count}},{key:"predictions",get:function(){return this.prediction_merger.predictions}},{key:"max_predictions",set:function(t){this._max_predictions=t},get:function(){return this._max_predictions}}]),n}();e.exports=n},{"../../../lib/rh":8,"./consts":14,"./indices":20,"./merger":23,"./prediction_creator":27,"./prediction_list":28}],18:[function(t,e,i){var n=t("../../../lib/rh")._,r=t("./prediction"),o=t("./input_parser"),s=t("./prediction_list"),a=t("./consts"),u=function(){function i(t,e){O(this,i),this._reader=t,this._predictions=[],this._callback=e,this._source=a.PREDICTOR_SOURCE_ID.HISTORY_PREDICTOR,this._max_predictions=void 0===a._max_history_predictions?2:a._max_history_predictions}return w(i,[{key:"getPredictions",value:function(t){return this._predictions=[],this._parsed_input=t,this._computePredictions(),this._callback&&this._callback(new s(this._predictions,this._parsed_input)),this._predictions}},{key:"init",value:function(){}},{key:"clear",value:function(){this._predictions=[]}},{key:"_computePredictions",value:function(){var e=this;""!==this._parsed_input.trimmedText&&(n.each(this._reader._list,function(t){e._match(t.text)&&e._predictions.push(e._createPrediction(t))}),this._purge())}},{key:"_purge",value:function(){this._predictions.splice(this._max_predictions)}},{key:"_createPrediction",value:function(t){return new r(t.text,1,t.count,this._source)}},{key:"_match",value:function(t){if(this._parsed_input.original_text.length>t.length)return!1;var e=new o(t,!0);return this._parsed_input.compare(e)}}]),i}();e.exports=u},{"../../../lib/rh":8,"./consts":14,"./input_parser":21,"./prediction":26,"./prediction_list":28}],19:[function(t,e,i){var n=t("../../../lib/rh")._,r=t("./utils"),o=function(){function t(){O(this,t)}return w(t,[{key:"initHistory",value:function(t){void 0===this._list&&(this._list=t||[])}},{key:"getHistory",value:function(){return this._list||[]}},{key:"_updateText",value:function(t,e){this.getHistory().splice(e,1),this.getHistory().unshift(t)}},{key:"_addNewText",value:function(t){this.getHistory().push(t)}},{key:"add",value:function(e){var t=n.findIndex(this.getHistory(),function(t){return 0===r.compareNoCase(e.text,t.text)});0<=t?this._updateText(e,t):this._addNewText(e)}},{key:"delete",value:function(e){var t=n.findIndex(this.getHistory(),function(t){return 0===r.compareNoCase(e,t.text)});0<=t&&this.getHistory().splice(t)}}]),t}();e.exports=new o},{"../../../lib/rh":8,"./utils":33}],20:[function(t,e,i){e.exports={MAP:{WORD:0,HASH:1,COUNT:2,MODEL_FILE_NO:3,MODEL_INDEX:4,TOPICS:5},MODEL:{WORD_HASH:0,COUNT:1,NEXT_MODEL:2},FIRST_PREDICTION:{NEXT:0,PREVIOUS:1}}},{}],21:[function(t,e,i){var s=t("./utils"),n=t("../../../../src/lib/rh")._,r=function(){function o(t,e,i,n){O(this,o),this.isPrevious=n,this.selection=void 0===i?t.length:i;var r=this._calculateSeparator(t);this.isPrevious||(this.isWholeWord=e||this._isWholeWord(t,r)),this.initText(t,r)}return w(o,[{key:"initText",value:function(t,e){this._computeText(t,e),this.trimmedText=this.original_text.trim(),this.words=n.compact(this.trimmedText.split(" ")||[]),this._reverseIfPrevious(),!this.isWholeWord&&0<this.words.length&&(this._partial=this.words.splice(-1)[0])}},{key:"_computeText",value:function(t,e){this._right_text="",this._left_text="",void 0===e&&(e=t.length),this.isSplitText=!(0===e||e===t.length);var i=t.substring(0,e),n=t.substring(e);this.isPrevious?(this.original_text=n,this._left_text=i.trim()):(this.original_text=i,this._right_text=n.trim())}},{key:"equalRemaingWord",value:function(t){if(""!==this._left_text||""!==this._right_text){var e=this._getRemainigWord();if(e)return 0===s.compareNoCase(e,t)}return!1}},{key:"_getRemainigWord",value:function(){var t=this.isPrevious?this._left_text.split(" "):this._right_text.split(" ");if(t=t||[],0<(t=n.compact(t)).length)return this.isPrevious?t[t.length-1]:t[0]}},{key:"completeSuggestion",value:function(t){return this.isPrevious?0===this._left_text.length?t:this._left_text+" "+t:0===this._right_text.length?t:t+" "+this._right_text}},{key:"_calculateSeparator",value:function(t){if(this.isPrevious){if(0===this.selection)return this.isWholeWord=!0,0;if(t.length>this.selection&&" "!==t[this.selection-1]){var e=t.lastIndexOf(" ",this.selection-1);return this.isWholeWord=!1,0<=e?e+1:0}this.isWholeWord=!0}return this.selection}},{key:"_reverseIfPrevious",value:function(){this.isPrevious&&this.words.reverse()}},{key:"_isWholeWord",value:function(t,e){return this.isPrevious?0===e||t.length>e&&" "===t[e-1]:0<e&&" "===t[e-1]}},{key:"compare",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;if(i=void 0===i?this.words.length-1:i,this.words.length>t.words.length)return!1;for(var n=e;n<=i;n++){var r=this.words[n],o=t.words[n];if(0!==s.compareNoCase(r,o))return!1}return this.matchPartial(t,n)}},{key:"matchPartial",value:function(t,e){if(void 0===this._partial)return!0;if(t.words.length<=e)return!1;var i=t.words[e];return this.comparePartial(i)}},{key:"comparePartial",value:function(t){return this._matchExp=new RegExp("^"+this._partial,"i"),this._matchExp.test(t)}},{key:"completeWord",value:function(t){return this.isWholeWord||void 0===this._partial||0===this._partial.length?this.getTermForCompleteWord(t,this.trimmedText):this.getTermForPartialText(t)}},{key:"getTermForPartialText",value:function(t){var e=t.substring(this._partial.length,t.length);if(this.isPrevious){var i="",n=this.trimmedText.indexOf(" ");return 0<=n&&(i=this.trimmedText.substring(n)),this._partial+e+i}return this.trimmedText+e}},{key:"getTermForCompleteWord",value:function(t){return this.isPrevious?t+" "+this.trimmedText:this.trimmedText+" "+t}},{key:"replaceLastWord",value:function(t){var e=this.trimmedText;if(void 0!==this._partial&&!this.isWholeWord){var i=this.trimmedText.length-this._partial.length;e=(e=this.trimmedText.substring(0,i)).trim()}return e+" "+t}},{key:"equalLastWord",value:function(t){if(0===this.words.length)return!1;var e=this.words[this.words.length-1];return 0===s.compareNoCase(e,t)}}]),o}();e.exports=r},{"../../../../src/lib/rh":8,"./utils":33}],22:[function(t,e,i){var n=t("../../../lib/rh"),o=n._,s=n.model,r=t("./utils"),a=t("./indices"),u=t("./consts"),l=t("./paths"),h=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";O(this,e),this._paths=new l(t)}return w(e,[{key:"init",value:function(t){this.loadIndex(t),this.loadMap(t)}},{key:"_isIndexLoaded",value:function(){return void 0!==this.index_data}},{key:"getModelCount",value:function(){return this.index_data.Model.length}},{key:"getMapHash",value:function(t){return this._hash_to_word[t]}},{key:"getHashes",value:function(t){if(void 0!==t&&0<t.length)return this.getAplhabetHashes(t[0])}},{key:"getAplhabetHashes",value:function(t){if(this.map_data&&1===t.length){var e=t.toLowerCase();return this.map_data[e]}}},{key:"getWordModel",value:function(t,e){var i=void 0,n=this._getHashForWord(t);return n&&e&&(i=e[n[a.MAP.MODEL_INDEX]]),i}},{key:"getCount",value:function(t){var e=this._getHashForWord(t);if(e)return e[a.MAP.COUNT]}},{key:"getModelData",value:function(t){var e=t[a.MAP.MODEL_FILE_NO],i=t[a.MAP.MODEL_INDEX],n=s.get(this._paths.getModelKey(e));return n||this.loadModel(e),n&&n[i]}},{key:"_compareWordCount",value:function(t,e){var i=r.getSafeElement(t,a.MAP.COUNT),n=r.getSafeElement(e,a.MAP.COUNT);return i&&n?n-i:0}},{key:"_buildTopWords",value:function(t){t.sort(this._compareWordCount),t.splice(100*u.max_predictions),this._top_words=t}},{key:"getModelFileNo",value:function(t){var e=this._getHashForWord(t);if(e)return e[a.MAP.MODEL_FILE_NO]}},{key:"_getHashForWord",value:function(t){var e=void 0,i=this.getHashKey(t);return i&&(e=this._hash_to_word[i]),e}},{key:"getHashKey",value:function(t){if(t&&0<t.length){var e=t.toLowerCase();return this._word_hash[e]}}},{key:"loadIndex",value:function(t){var e=this;!1===this._isIndexLoaded()?o.loadScript(this._paths.getIndexFilePath(),!0,function(){e.index_data=o.exports(),e.onIndexLoaded(t)},!0):this.onIndexLoaded(t)}},{key:"loadModel",value:function(t,e){if(void 0!==t){var i=this._paths.getModelKey(t),n=s.get(i);if(void 0===n){s.publish(i,null);var r=this._paths.getModelFilePath(t);o.loadScript(r,!0,this.getOnModelLoadFn(t,e),!0)}else null===n&&void 0!==e?s.subscribe(i,e):this.doCallback(e,n,t)}else this.doCallback(e,[],t)}},{key:"doCallback",value:function(t,e,i){t&&t(e,i)}},{key:"getOnModelLoadFn",value:function(e,i){var n=this;return function(){var t=o.exports();s.publish(n._paths.getModelKey(e),t),i&&i(t,e)}}},{key:"onMapLoaded",value:function(t){this.parseMap(),this.index_data&&t&&t(this)}},{key:"onIndexLoaded",value:function(t){this.map_data&&t&&t(this)}},{key:"parseMap",value:function(){var t=this.map_data;this._word_hash={},this._hash_to_word={};var e=[];for(var i in t){var n=t[i];this._parseWordsData(n),e=e.concat(n)}this._buildTopWords(e)}},{key:"_parseWordsData",value:function(t){var n=this;o.each(t,function(t){var e=parseInt(t[a.MAP.HASH]);if(t[a.MAP.WORD]){var i=t[a.MAP.WORD].toString();n._word_hash[i]=e}n._hash_to_word[e]=t})}},{key:"isStopWord",value:function(e){return void 0!==o.find(this.index_data.stopWords,function(t){return 0===r.compareNoCase(e,t)})}},{key:"getTotalCount",value:function(){return this.index_data.totalCount}},{key:"wordHashfromIndexKey",value:function(e,i){return o.find(this._hash_to_word,function(t){return t[a.MAP.MODEL_INDEX]===e&&t[a.MAP.MODEL_FILE_NO]===i})}},{key:"loadMap",value:function(t){var e=this;void 0===this.map_data?o.loadScript(this._paths.getMapFilePath(),!0,function(){e.map_data=o.exports(),e.onMapLoaded(t)},!0):this.onMapLoaded(t)}},{key:"top_words",get:function(){return this._top_words}},{key:"nGram",get:function(){return this.index_data.nGram}},{key:"search_model",get:function(){return this.index_data.Model}},{key:"search_map",get:function(){return this.index_data.Map}},{key:"total_count",get:function(){return this.index_data.totalCount}},{key:"stop_words",get:function(){return this.index_data.stopWords}}]),e}();e.exports=h},{"../../../lib/rh":8,"./consts":14,"./indices":20,"./paths":25,"./utils":33}],23:[function(t,e,i){var n=t("../../../lib/rh")._,r=t("./utils"),o=function(){function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:20;O(this,i),this._predictions=t,this._max_predictions=e}return w(i,[{key:"merge",value:function(t){var e=this;n.each(t,function(t){e.mergePrediction(t)}),this._sort(),this._purge()}},{key:"clear",value:function(){this._predictions=[]}},{key:"_purge",value:function(){this._predictions.length>this._max_predictions&&this._predictions.splice(this._max_predictions)}},{key:"mergePrediction",value:function(t){var e=this.find_prediction(t.term);e?this.merge_item(e,t):this._predictions.push(t)}},{key:"_sort",value:function(){this.predictions.sort(this.compare_predictions)}},{key:"compare_predictions",value:function(t,e){return e.probability-t.probability}},{key:"find_prediction",value:function(e){return n.find(this._predictions,function(t){return 0===r.compareNoCase(t.term,e)})}},{key:"merge_item",value:function(t,e){t.probability+=e.probability,t.count=Math.max(t.count,e.count)}},{key:"predictions",get:function(){return this._predictions}}]),i}();e.exports=o},{"../../../lib/rh":8,"./utils":33}],24:[function(t,e,i){var n=t("../../../lib/rh")._,r=t("./prediction_creator"),o=t("./prediction_list"),u=t("./consts"),l=t("./indices"),s=function(){function a(t){var e=t.loader,i=t.level,n=t.callback,r=t.previous,o=t.max_predictions,s=void 0===o?20:o;O(this,a),this.level=i,this.previous=r,this._max_predictions=s,this.predictions=[],this._callback=n,this._loader=e,this._source=u.PREDICTOR_SOURCE_ID.NGRAM_PREDICTOR}return w(a,[{key:"init",value:function(){}},{key:"clear",value:function(){this._word_model=void 0,this._prediction_array=void 0,this.parsed_input=void 0,this.predictions=[]}},{key:"getPredictions",value:function(t){this.parsed_input=t,this.predictions=[],void 0!==t&&t.words.length>=this.level?(this.word_index=t.words.length-this.level,this._word=t.words[this.word_index],this._loadInputModel(this._word,this._compute_word_predictions.bind(this))):this._onResultsComputed()}},{key:"_compute_word_predictions",value:function(t){this.predictions=[];var e=this.level,i=this._word,n=this._loader.getCount(i);this._word_model=this._loader.getWordModel(i,t),this._word_model&&(this._prediction_array=this._get_prediction_array(),this._compute_prediction_from_model(i,e,n)),this._onResultsComputed()}},{key:"_onResultsComputed",value:function(){this._callback&&this._callback(new o(this.predictions,this.parsed_input),this._loader)}},{key:"_compute_prediction_from_model",value:function(t,e,i){if(void 0!==this._prediction_array)if(this._is_my_level(e))this._compute_next_words(i);else{e--;var n=this._get_word_index(e),r=this.parsed_input.words[n],o=this._loader.getHashKey(r),s=this._get_next_model(this._prediction_array,o);s&&(i=s[l.MODEL.COUNT],this._prediction_array=s[l.MODEL.NEXT_MODEL],this._compute_prediction_from_model(r,e,i))}}},{key:"_get_next_model",value:function(t,e){if(e){var i=n.find(t,function(t){return 1<t.length&&t[l.MODEL.WORD_HASH]===e});return i&&i.length>l.MODEL.NEXT_MODEL&&Array.isArray(i)?i:void 0}}},{key:"_get_word_index",value:function(t){return this.parsed_input.words.length-t}},{key:"_is_my_level",value:function(t){return 1===t}},{key:"_continueFn",value:function(){return!0}},{key:"_compute_next_words",value:function(t){var e=this._prediction_array;if(e&&0<e.length)for(var i=0;this.predictions.length<this.max_predictions&&i<e.length&&1<e[i].length;i++)if(this._matches_partially(e[i])){var n=this._create_predictions(e[i],t);this._compute_next_multi_words(n)}}},{key:"_compute_next_multi_words",value:function(t){var e=this;n.each(t,function(t){void 0!==t&&e.predictions.push(t)})}},{key:"_get_word_hash",value:function(t){return this._loader.getMapHash(t[l.MODEL.WORD_HASH])}},{key:"_matches_partially",value:function(t){if(this.parsed_input.isWholeWord)return!0;var e=this._loader.getMapHash(t[l.MODEL.WORD_HASH]);if(!e)return!1;var i=e[l.MAP.WORD];return this.parsed_input.comparePartial(i)}},{key:"_create_predictions",value:function(t,e){return new r({loader:this._loader,model_item:t,total_count:e,parsed_input:this.parsed_input,continueFn:this._continueFn}).getMultiPredictions(void 0,void 0,void 0,this._source)}},{key:"_get_prediction_array",value:function(){return this.parsed_input.isPrevious&&1<this._word_model.length?this._word_model[1]:this._word_model[0]}},{key:"_loadInputModel",value:function(t,e){var i=this._findFileIndex(t);this._loader.loadModel(i,e)}},{key:"_findFileIndex",value:function(t){return this._loader.getModelFileNo(t)}},{key:"max_predictions",set:function(t){this.max_predictions=t},get:function(){return this._max_predictions}}]),a}();e.exports=s},{"../../../lib/rh":8,"./consts":14,"./indices":20,"./prediction_creator":27,"./prediction_list":28}],25:[function(t,e,i){var n=t("../../../lib/rh").consts,r=function(){function e(t){O(this,e),this._path=t||"",this.initPath()}return w(e,[{key:"initPath",value:function(){"."===this._path&&(this._path=""),"."===this._path[0]&&"/"===this._path[1]&&(this._path=this._path.slice(2))}},{key:"_getModelFileName",value:function(t){return n("SEARCH_MODEL_ADDR")+t.toString()+".js"}},{key:"getModelFilePath",value:function(t){var e=this._getModelFileName(t);return this._getRelativePath(e)}},{key:"_getRelativePath",value:function(t){return""===this._path?t:this._path+"/"+t}},{key:"_getPathKey",value:function(){return""===this._path?"":"_"+this._path+"_"}},{key:"getModelKey",value:function(t){return n("SEARCH_MODEL_KEY")+this._getPathKey()+t.toString()}},{key:"_getMapFileName",value:function(){return n("SEARCH_MAP_ADDR")}},{key:"getMapFilePath",value:function(){var t=this._getMapFileName();return this._getRelativePath(t)}},{key:"getIndexFilePath",value:function(){var t=n("SEARCH_INDEX_FILE");return this._getRelativePath(t)}}]),e}();e.exports=r},{"../../../lib/rh":8}],26:[function(t,e,i){e.exports=function t(e,i,n,r){O(this,t),this.probability=i,this.term=e,this.count=n,this.source=r}},{}],27:[function(t,e,i){var n=t("./prediction"),r=t("./utils"),o=t("./indices"),a=t("./input_parser"),u=t("./consts"),s=function(){function s(t){var e=t.loader,i=t.model_item,n=t.total_count,r=t.parsed_input,o=t.continueFn;O(this,s),this._model_item=i,this.parsed_input=r||new a(""),this._init(),this._total_count=n,this._continueFn=o||this._isStopWord,this._nextModelFn=this._nextModel,this._predictions=[],this._multi_prediction=!1,this._loader=e}return w(s,[{key:"_init",value:function(){this.term="",this.probability=1,this._first_word=!0,this.isFirstLevel=!1,this._level=0}},{key:"getPrediction",value:function(t,e,i,n){return this.word_hash=t,this.isFirstLevel=e,this.previous=i,this.source=n,this.isFirstLevel&&this._appendPreviousPredictions(this._model_item),this._appendPrediction(this._model_item,t),this._createPrediction()}},{key:"getMultiPredictions",value:function(t,e,i,n){return this._multi_prediction=!0,this.word_hash=t,this.isFirstLevel=e,this.previous=i,this.source=n,this.isFirstLevel&&this._appendPreviousPredictions(this._model_item),this._appendPrediction(this._model_item,t),this._predictions}},{key:"equalRemaingWord",value:function(t){var e=this._getword(t,this.word_hash);return!(!e||!this.parsed_input.equalRemaingWord(e))}},{key:"_appendPreviousPredictions",value:function(t){var e=this._getPreviousItem(t);e&&(this._getPreviousProbability(e)>u.minPreviousThreshold&&this._appendPreviousTerm(e))}},{key:"_getPreviousItem",value:function(t){var e=r.getFirstLevelNextModel(t,!0);if(e)return r.getSafeElement(e,0)}},{key:"_appendPreviousTerm",value:function(t){var e=this._getword(t);if(e){if(this.parsed_input.equalLastWord(e))return;this.term=this.parsed_input.replaceLastWord(e),this._first_word=!1}}},{key:"_createPrediction",value:function(){if(""!==this.term){var t=this.parsed_input.completeSuggestion(this.term);return new n(t,this.probability,1,this.source)}}},{key:"_appendPrediction",value:function(t){if(this.probability=this.probability*this._calculateProbability(t),this._update_term(t),this._shouldCreatePrediction(t)&&this._predictions.push(this._createPrediction()),this._continueFn(t)){var e=this._nextModel(t);this._total_count=this._getCount(t),this._level++,this._first_word=!1,this.isFirstLevel=!1,this.word_hash=void 0,e&&this._appendPrediction(e)}}},{key:"_getPreviousProbability",value:function(t){var e=this._getCount(this.model_item);return r.getCountfromModel(t)/e}},{key:"_update_term",value:function(t){this.parsed_input.isPrevious?this.term=this._nextTerm(t)+this.term:this.term=this.term+this._nextTerm(t)}},{key:"_getword",value:function(t,e){return e=e||this._get_word_hash(t),r.getSafeElement(e,o.MAP.WORD)}},{key:"_get_word_hash",value:function(t){return this._loader.getMapHash(t[o.MODEL.WORD_HASH])}},{key:"_nextModel",value:function(t){var e=void 0;if((e=this.isFirstLevel?r.getFirstLevelNextModel(t,this.previous):r.getNextModel(t))&&0<e.length)return r.getFirstPrediction(e)}},{key:"_nextTerm",value:function(t){var e=this._getword(t,this.word_hash);return e?this._first_word?this.parsed_input.completeWord(e):" "+e:""}},{key:"_calculateProbability",value:function(t){return this._getCount(t)/this._total_count}},{key:"_getCount",value:function(t){return this.word_hash?r.getCountfromWordHash(this.word_hash):r.getCountfromModel(t)}},{key:"_shouldCreatePrediction",value:function(t){return this._multi_prediction&&!this._isStopWord(t)&&!this.equalRemaingWord(t)}},{key:"_isStopWord",value:function(t){var e=this._getword(t,this.word_hash);return!!e&&this._loader.isStopWord(e)}}]),s}();e.exports=s},{"./consts":14,"./indices":20,"./input_parser":21,"./prediction":26,"./utils":33}],28:[function(t,e,i){var n=function(){function i(t,e){O(this,i),this.parsed_input=e,this._list=t||[]}return w(i,[{key:"isForInput",value:function(t,e){return this.parsed_input.isPrevious?void 0!==e&&this.parsed_input.original_text===e.original_text:this.parsed_input.original_text===t.original_text}},{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"predictions",get:function(){return this._list}}]),i}();e.exports=n},{}],29:[function(t,e,i){var n=t("./loader"),r=t("../../../lib/rh"),s=r._,a=t("./history_predictor"),u=t("./ngram_predictor"),l=t("./general_predictor"),h=t("./corrector"),c=t("./consts"),o=function(){function i(t,e){O(this,i),this._history_reader=t,this._processResultFn=e}return w(i,[{key:"_getProjectPaths",value:function(){return r.model.get(r.consts("KEY_PROJECT_LIST"))}},{key:"_createLoaders",value:function(){var e=[],t=this._getProjectPaths();return s.each(t,function(t){e.push(new n(t))}),e}},{key:"createPredictors",value:function(t,e,i){var n=this;this._addFn=t,this._prevaddFn=e,this._addCorrectorFn=i;var r=new a(this._history_reader,this._processResultFn);this._addFn(r);var o=this._createLoaders();s.each(o,function(t){t.init(n.addPredictors.bind(n))})}},{key:"addPredictors",value:function(t){for(var e=1;e<=t.nGram;e++){var i=new u({loader:t,level:e,callback:this._processResultFn});i.init(),this._addFn(i)}for(var n=1;n<=c.previousnGram;n++){var r=new u({loader:t,level:n,callback:this._processResultFn,previous:!0});r.init(),this._prevaddFn(r)}var o=new l(this._processResultFn,t);this._addFn(o);var s=new h(t,this._processResultFn);this._addCorrectorFn(s)}}]),i}();e.exports=o},{"../../../lib/rh":8,"./consts":14,"./corrector":15,"./general_predictor":17,"./history_predictor":18,"./loader":22,"./ngram_predictor":24}],30:[function(t,e,i){var n=t("../../../lib/rh"),o=n._,s=n.consts,r=t("./history_reader"),a=t("./input_parser"),u=t("./merger"),l=t("./topic_counter"),h=t("./utils"),c=t("./consts"),d=t("./counting_seamaphore"),_=t("./predictors_creator"),p=5,f=function(){function i(t){var e=this;O(this,i),this.widget=t,this._predictors=[],this._correctors=[],this._previous_predictors=[],this.initHandleKeyHash(),this.max_predictions=p,this.predicton_merger=new u([]),t.model.subscribe(s("KEY_PROJECT_LIST"),function(){e.init()})}return w(i,[{key:"init",value:function(){var t=n.storage.fetch(s("PREV_SEARCH_KEY"));r.initHistory(t),this.create_predictors(),this.widget.model.csubscribe("EVT_CLOSE_SEARCH_SUGGESTION",this.closeSuggestions.bind(this))}},{key:"create_predictors",value:function(){this._predictors=[],new _(r,this.processResult.bind(this)).createPredictors(this.addPredictor.bind(this),this.addPrevPredictor.bind(this),this.addCorrector.bind(this))}},{key:"addPredictor",value:function(t){this._predictors.push(t)}},{key:"addPrevPredictor",value:function(t){this._previous_predictors.push(t)}},{key:"addCorrector",value:function(t){this._correctors.push(t)}},{key:"showSuggestions",value:function(t){this._initSuggestions(t),this._calculateSugguestions()}},{key:"_initSuggestions",value:function(t){this._initResult(),this._initInputs(t),this._resutSeamaphore=new d(this.onResultComplete.bind(this))}},{key:"_initInputs",value:function(t){this.parsed_input=new a(t.text,!1,t.selStart,!1),h.isPrevious(t)&&(this._previous_input=new a(t.text,!1,t.selStart,!0))}},{key:"_calculateSugguestions",value:function(){var e=this;this._resutSeamaphore.wait(this._predictorCount()),o.each(this._predictors,function(t){t.getPredictions(e.parsed_input)}),this._previous_input&&o.each(this._previous_predictors,function(t){t.getPredictions(e._previous_input)})}},{key:"_clearPredictors",value:function(){o.each(this._predictors,function(t){t.clear()}),o.each(this._previous_predictors,function(t){t.clear()}),o.each(this._correctors,function(t){t.clear()})}},{key:"_predictorCount",value:function(){var t=this._predictors.length;return this._previous_input&&(t+=this._previous_predictors.length),t}},{key:"_initResult",value:function(){this.predicton_merger&&this.predicton_merger.clear(),this.widget.publish("selected",void 0),this._previous_input=void 0,this._computing_correction=!1}},{key:"_clearResult",value:function(){this._resetMovement(),this._previous_input=void 0,this.parsed_input=void 0,this._resutSeamaphore=void 0,this._clearPredictors()}},{key:"isSuggestionsOpen",value:function(){var t=this.widget.get(s("SEARCH_RESULTS_KEY"));return t&&0<t.length}},{key:"processResult",value:function(t,e){if(t.isForInput(this.parsed_input,this._previous_input)){if(!t.isEmpty()){this.predicton_merger.merge(t.predictions);var i=new l(e);this.predictions=i.computeCounts(this.predictions,this.parsed_input)}this._resutSeamaphore.signal()}}},{key:"onResultComplete",value:function(){this.needCorrection()?this.doCorrection():(this.predictions.splice(this.max_predictions),this.widget.publish(s("SEARCH_RESULTS_KEY"),this.predictions),this._clearResult())}},{key:"needCorrection",value:function(){return!this._computing_correction&&0===this.predictions.length&&""!==this.parsed_input.trimmedText}},{key:"doCorrection",value:function(){var e=this;this._computing_correction=!0,this._resutSeamaphore=new d(this.onResultComplete.bind(this)),this._resutSeamaphore.wait(this._correctors.length),o.each(this._correctors,function(t){t.getCorrections(e.parsed_input)})}},{key:"canDelete",value:function(t){var e=this.predictions[t];return void 0!==e&&e.source===c.PREDICTOR_SOURCE_ID.HISTORY_PREDICTOR}},{key:"handleDelete",value:function(t){var e=this.predictions[t];this._deleteFromHistory(e.term),this._removePrediction(t),this.widget.publish("history_deleted",!0)}},{key:"_removePrediction",value:function(t){this.predictions.splice(t,1),this.widget.publish(s("SEARCH_RESULTS_KEY"),this.predictions)}},{key:"handleClick",value:function(t){if(!this.widget.get("history_deleted")){var e=this.predictions[t];if(void 0!==e){var i=e.term;this._addToHistory(i),this.widget.publish(s("KEY_SEARCH_TERM"),i),this.widget.publish(n.consts("EVT_SEARCH_TERM"),!0)}}}},{key:"handleFocusOut",value:function(t,e){this.widget.get("history_deleted")?(this.widget.publish("history_deleted",!1),this.widget.publish(e,!0)):this.widget.publish(t,!1)}},{key:"getFirstSuggestionIndex",value:function(t,e){return e?0:t-1}},{key:"getNextSuggestionIndex",value:function(t,e,i){return t=((t=void 0===t?0:t)+(i?1:e-1))%e}},{key:"handleArrowKey",value:function(t){var e=this.widget.get("selected"),i=40===t.keyCode,n=this.getPredictionsLength();if(0<n){e=void 0===e?this.getFirstSuggestionIndex(n,i):this.getNextSuggestionIndex(e,n,i),this.widget.publish("selected",e);var r=this.getNewInputText(this.results[e]);this.widget.publish(s("KEY_SEARCH_TERM"),r)}}},{key:"getNewInputText",value:function(t){return t.term}},{key:"getPredictionsLength",value:function(){var t=void 0;return this.results=this.widget.get(s("SEARCH_RESULTS_KEY")),this.results&&(t=this.results.length),t}},{key:"closeSuggestions",value:function(){this._clearResult(),this.widget.publish("selected",void 0),this.original_parsed_input=void 0,this.widget.publish(s("SEARCH_RESULTS_KEY"),[])}},{key:"_deleteFromHistory",value:function(t){r.delete(t),this._saveHistory()}},{key:"_addToHistory",value:function(t){t&&""!==t&&(r.add({text:t.trim(),count:10}),this._saveHistory())}},{key:"_saveHistory",value:function(){n.storage.persist(s("PREV_SEARCH_KEY"),r.getHistory())}},{key:"handleShowSuggestion",value:function(t){""===t.text||!1===h.shouldShowSuggestion(t)?this.closeSuggestions():this.showSuggestions(t)}},{key:"handleReturn",value:function(t){""!==t.text&&(this._addToHistory(t.text),this.closeSuggestions())}},{key:"_isMovementKey",value:function(t){return 0<=[38,39,40].indexOf(t)}},{key:"_resetMovement",value:function(){this.original_parsed_input=void 0,this.widget.publish("selected",void 0)}},{key:"_isHandlingCursorMove",value:function(){return void 0!==this.widget.get("selected")}},{key:"initHandleKeyHash",value:function(){this.handle_key_hash={up:this.handleArrowKey.bind(this),down:this.handleArrowKey.bind(this),backspace:this.handleBackSpace.bind(this),return:this.handleReturn.bind(this),default:this.handleShowSuggestion.bind(this),escape:this.handleEscape.bind(this),right:this.handleRight.bind(this)}}},{key:"handleRight",value:function(t){return this._isHandlingCursorMove()?(h.shouldAppendSpace(t)&&(t.text+=" ",t.selStart+=1,this.widget.publish(s("KEY_SEARCH_TERM"),t.text)),this._resetMovement(),this.handleShowSuggestion(t),!1):(this._resetMovement(),this.handleShowSuggestion(t))}},{key:"handleBackSpace",value:function(t){return this.handleShowSuggestion(t)}},{key:"handleEscape",value:function(){this.closeSuggestions()}},{key:"handleKey",value:function(t){var e=t.keyCode,i={keyCode:e,selStart:t.target.selectionStart,text:t.target.value};this._isMovementKey(e)||this._resetMovement();var n=o.getKeyIndex(e);if(void 0===n)return!0;var r=this.handle_key_hash[n];return r?r(i):void 0}},{key:"predictions",get:function(){return this.predicton_merger.predictions},set:function(t){this.predicton_merger=new u(t)}}]),i}();n.controller("SearchController",f)},{"../../../lib/rh":8,"./consts":14,"./counting_seamaphore":16,"./history_reader":19,"./input_parser":21,"./merger":23,"./predictors_creator":29,"./topic_counter":32,"./utils":33}],31:[function(t,e,i){var n=function(){function e(t){O(this,e),this._set=t||[],this._initialised=!1}return w(e,[{key:"intersect",value:function(t){Array.isArray(t)||(t=t.set);for(var e=[],i=0,n=0,r=0;n<this._set.length&&r<t.length;)this._set[n]<t[r]?n++:(this._set[n]>t[r]||(e[i++]=this._set[n],n++),r++);this._set=e}},{key:"intersectOrSet",value:function(t){this._initialised?this.intersect(t):(Array.isArray(t)||(t=t.set),this.set=t,this._initialised=!0)}},{key:"intersectCount",value:function(t){Array.isArray(t)||(t=t.set);for(var e=0,i=0,n=0;i<this._set.length&&n<t.length;)this._set[i]<t[n]?i++:(this._set[i]>t[n]||(e++,i++),n++);return e}},{key:"set",set:function(t){this._set=t||[]},get:function(){return this._set}},{key:"length",get:function(){return this._set.length}}]),e}();e.exports=n},{}],32:[function(t,e,i){var n=t("./sorted_set"),r=t("./input_parser"),o=t("./prediction"),s=t("../../../lib/rh")._,a=t("./indices"),u=function(){function e(t){O(this,e),this.newPredictions=[],this.predictionSet=new n,this.inputSet=new n,this._loader=t}return w(e,[{key:"computeCounts",value:function(t,e){var i=this;return this.newPrediction=[],this.parsed_input=e,s.each(t,function(t){i.addUpdatedPrediction(t)}),this.newPredictions}},{key:"addUpdatedPrediction",value:function(t){var e=1;if(void 0!==this._loader&&(this.createPredictionSet(t),e=this.computeTopicCount()),0<e){var i=new o(t.term,t.probability,e,t.source);this.newPredictions.push(i)}}},{key:"computeTopicCount",value:function(){return this.predictionSet.set.length}},{key:"createPredictionSet",value:function(t){var i=this;this.predictionSet=new n;var e=new r(t.term,!0);s.each(e.words,function(t,e){i._addWordToSet(t,i.predictionSet,e)})}},{key:"initInput",value:function(t){var e=this;this.inputSet=new n,s.each(t.words,function(t){e._addWordToSet(t,e.inputSet)})}},{key:"_addWordToSet",value:function(t,e){if(!this._loader.isStopWord(t)){var i=this._loader._getHashForWord(t);i&&i.length>a.MAP.TOPICS&&e.intersectOrSet(i[a.MAP.TOPICS])}}}]),e}();e.exports=u},{"../../../lib/rh":8,"./indices":20,"./input_parser":21,"./prediction":26,"./sorted_set":31}],33:[function(e,r,t){(function(i){var n=e("./indices"),t={getNextModel:function(t){if(t&&Array.isArray(t)&&t.length>n.MODEL.NEXT_MODEL)return t[n.MODEL.NEXT_MODEL]},getFirstLevelNextModel:function(t,e){if(t&&Array.isArray(t)){if(!e&&t.length>n.FIRST_PREDICTION.NEXT)return t[n.FIRST_PREDICTION.NEXT];if(e&&t.length>n.FIRST_PREDICTION.PREVIOUS)return t[n.FIRST_PREDICTION.PREVIOUS]}},getFirstPrediction:function(t){if(t&&Array.isArray(t)&&0<t.length&&Array.isArray(t[0]))return t[0]},compareNoCase:function(t,e){return void 0!==i.compare?i.compare(t,e):t===e?0:-1},hammingDistance:function(t,e){for(var i=Math.min(t.length,e.length),n=0,r=0;r<i;r++)t[r]!==e[r]&&n++;return t.length>i&&(n+=t.length-i),n},isPrevious:function(t){return t.selStart<t.text.length},shouldShowSuggestion:function(t){var e=t.text,i=t.selStart;return 0===i||i===e.length||0<e.length&&(" "===e[i]||" "===e[i-1])},shouldAppendSpace:function(t){var e=t.text,i=t.selStart;return 0<e.length&&i===e.length&&" "!==e[e.length-1]},getSafeElement:function(t,e){if(t&&Array.isArray(t)&&t.length>e)return t[e]},getCountfromModel:function(t){return Array.isArray(t)&&t.length>n.MODEL.COUNT?t[n.MODEL.COUNT]:0},getCountfromWordHash:function(t){return Array.isArray(t)&&t.length>n.MAP.COUNT?t[n.MAP.COUNT]:0}};r.exports=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0!==k?k:{})},{"./indices":20}],34:[function(t,e,i){var n=t("../../lib/rh"),s=n._,a=n.consts,r=function(){function e(t){O(this,e),this.widget=t}return w(e,[{key:"getLink",value:function(t){var e=t,i=this.widget.get(a("KEY_SEARCH_RESULT_PARAMS")),n=this.widget.get(a("KEY_SEARCH_TERM")),r="";if(n&&""!==n){var o={};o[a("HASH_KEY_RH_SEARCH")]=n,r=s.mapToEncodedString(o)}return void 0!==i&&""!==i?e=e+i+"&"+r:""!==r&&(e=e+"?"+r),e}}]),e}();n.controller("SearchResultController",r)},{"../../lib/rh":8}],35:[function(t,e,i){var n=t("../../lib/rh"),r=n._,o=n.consts,s=function(){function e(t){O(this,e),this.widget=t}return w(e,[{key:"select",value:function(t,e){this.widget.publish(o("KEY_TOC_SELECT_ITEM"),{id:t,url:e})}},{key:"getLink",value:function(t){if(t){var e=this.widget.get(o("KEY_TOC_BREADCRUMBS"))[t];if(e&&e.hasUrl)return e.url}}},{key:"goToHome",value:function(t){if(t){var e=this.widget.get(o("KEY_TOC_BREADCRUMBS"))[t];e&&!e.hasUrl&&r.goToHome({rhtocid:e.id})}}}]),e}();n.controller("TocBreadcrumbsController",s)},{"../../lib/rh":8}],36:[function(t,e,i){var r=t("../../../lib/rh"),o=r.$,s="change",n=function(){function n(t,e){var i=this;O(this,n),this.widget=t,this.node=this.widget.node,this.tab=0,r.model.subscribeOnce(r.consts(e.key),function(){i.widget.publish(s,!0)}),r.model.subscribe(r.consts("KEY_SCREEN"),function(){i.goto(i.tab,0)}),r.model.subscribe(e.key+"gototab",function(t){i.goto(i.pagecount(),t.tab)})}return w(n,[{key:"goto",value:function(t,e){var i=this;this.tab=e,this.carouselnode=o.find(this.node,".carousel")[0],this.animateLeft(t),r._.delay(function(){i.widget.publish(s,!0)},1e3)}},{key:"hasNext",value:function(){this.carouselnode=o.find(this.node,".carousel")[0];var t=o.find(o.find(this.node,".carousel")[0],".carousel-item:not(.hide):not(.rh-hide)");return(t=t&&0<t.length?t[t.length-1]:null).offsetLeft+this.carouselnode.offsetLeft>this.carouselnode.offsetWidth}},{key:"animateLeft",value:function(){var t="calc(-"+14*this.tab+"px - "+100*this.tab+"%)";o.css(this.carouselnode,"left",t)}},{key:"next",value:function(){this.goto(this.tab,this.tab+1)}},{key:"pagecount",value:function(){return this.tab}},{key:"previous",value:function(){this.goto(this.tab,this.tab-1)}},{key:"ensureVisible",value:function(){}}]),n}();r.controller("Carousel",n)},{"../../../lib/rh":8}],37:[function(t,e,i){var n=t("../../lib/rh").$;e.exports={nodeType:{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},removeChild:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.parentNode(t);return e&&e.removeChild&&e.removeChild(t)},appendChild:function(t,e){return t&&t.appendChild&&t.appendChild(e)},parentNode:function(t){return t&&t.parentNode},childNodes:function(t){return t&&t.childNodes||[]},toHtmlNode:function(t){return this.childNodes(n.createElement("div",t))},outerHTML:function(t){return t&&t.outerHTML||""},insertAfter:function(t,e){return t.parentNode.insertBefore(e,t.nextSibling)},value:function(t){return t&&t.nodeValue},name:function(t){return t&&t.nodeName},type:function(t){return t&&t.nodeType},isElementNode:function(t){return this.type(t)===this.nodeType.ELEMENT_NODE},isTextNode:function(t){return this.type(t)===this.nodeType.TEXT_NODE}}},{"../../lib/rh":8}]},{},[9])}(window,document,window.location);