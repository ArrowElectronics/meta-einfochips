From cabfff259755e4886564aa92a312923180447dce Mon Sep 17 00:00:00 2001
From: Tejas Patel <tejas.patel1@einfochips.com>
Date: Mon, 18 Oct 2021 19:00:45 +0530
Subject: [PATCH 6/6] IMX8 THOR96: Configure low speed expansion gpio

Signed-off-by: Tejas Patel <tejas.patel1@einfochips.com>
---
 board/freescale/imx8mq_thor96/imx8mq_thor96.c | 27 +++++++++++++++++++
 1 file changed, 27 insertions(+)

diff --git a/board/freescale/imx8mq_thor96/imx8mq_thor96.c b/board/freescale/imx8mq_thor96/imx8mq_thor96.c
index 4777e00193..131fdbfe59 100644
--- a/board/freescale/imx8mq_thor96/imx8mq_thor96.c
+++ b/board/freescale/imx8mq_thor96/imx8mq_thor96.c
@@ -264,6 +264,32 @@ static void zigbee_reset_init(void)
 
 }
 
+static iomux_v3_cfg_t const gpio_exp[] = {
+    IMX8MQ_PAD_SD1_DATA4__GPIO2_IO6 | MUX_PAD_CTRL(NO_PAD_CTRL),
+    IMX8MQ_PAD_SD1_DATA5__GPIO2_IO7 | MUX_PAD_CTRL(NO_PAD_CTRL),
+    IMX8MQ_PAD_SD1_DATA6__GPIO2_IO8 | MUX_PAD_CTRL(NO_PAD_CTRL),
+    IMX8MQ_PAD_SD1_DATA7__GPIO2_IO9 | MUX_PAD_CTRL(NO_PAD_CTRL),
+};
+
+static void gpio_exp_set_init(void)
+{
+       printf("gpio_exp_set_init start\n");
+       imx_iomux_v3_setup_multiple_pads(gpio_exp,ARRAY_SIZE(gpio_exp));
+       gpio_request(IMX_GPIO_NR(2, 06), "gpio_exp2_6");
+       gpio_request(IMX_GPIO_NR(2, 07), "gpio_exp2_7");
+       gpio_request(IMX_GPIO_NR(2, 8), "gpio_exp2_8");
+       gpio_request(IMX_GPIO_NR(2, 9), "gpio_exp2_9");
+       gpio_direction_output(IMX_GPIO_NR(2, 06), 1);
+       gpio_direction_output(IMX_GPIO_NR(2, 07), 1);
+       gpio_direction_output(IMX_GPIO_NR(2, 8), 1);
+       gpio_direction_output(IMX_GPIO_NR(2, 9), 1);
+       gpio_direction_output(IMX_GPIO_NR(2, 06), 0);
+       gpio_direction_output(IMX_GPIO_NR(2, 07), 0);
+       gpio_direction_output(IMX_GPIO_NR(2, 8), 0);
+       gpio_direction_output(IMX_GPIO_NR(2, 9), 0);
+       printf("gpio_exp_set_init stop\n");
+}
+
 #if defined(CONFIG_USB_DWC3) || defined(CONFIG_USB_XHCI_IMX8M)
 int board_usb_init(int index, enum usb_init_type init)
 {
@@ -321,6 +347,7 @@ int board_init(void)
 #endif
 	user_leds_init();
 	zigbee_reset_init();
+	gpio_exp_set_init();
 	return 0;
 }
 
-- 
2.17.1

